<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://hugolmn.github.io/blog</id>
    <title>Hugo Le Moine Blog</title>
    <updated>2022-06-11T00:00:00.000Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://hugolmn.github.io/blog"/>
    <subtitle>Hugo Le Moine Blog</subtitle>
    <icon>https://hugolmn.github.io/img/favicon.ico</icon>
    <entry>
        <title type="html"><![CDATA[Twitter API - Delete my tweets!]]></title>
        <id>https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets</id>
        <link href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets"/>
        <updated>2022-06-11T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[I reset my account using twitter API, to delete all my existing tweets.]]></summary>
        <content type="html"><![CDATA[<p>I opened my twitter account <a href="https://twitter.com/hugo_le_moine_" target="_blank" rel="noopener noreferrer">@hugo_le_moine_</a> back in 2012 during my high school years, and have mostly used it to retweet/like content, using it like a bookmarking tool. Over time, I accumulated a couple hundreds tweets and I certainly don't remember &gt;95% of them.</p>
<p>It's now time for a deep cleaning!</p>
<p>But... Twitter does not let you delete more than a tweet at time. Then how to automate this ?</p>
<hr>
<h1>Twitter API</h1>
<p>Leveraging <a href="https://developer.twitter.com/en/docs/api-reference-index" target="_blank" rel="noopener noreferrer">Twitter API</a> is the first option I explored. Twitter has built quite a comprehensive set of endpoints enabling developer to:</p>
<ul>
<li>
<p>Post and delete a tweet / retweet / like / quote / bookmark</p>
</li>
<li>
<p>Search tweets</p>
</li>
<li>
<p>Follow / unfollow</p>
</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="applying-for-a-developer-account">Applying for a developer account<a href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets#applying-for-a-developer-account" class="hash-link" aria-label="Direct link to Applying for a developer account" title="Direct link to Applying for a developer account">​</a></h5>
<p>Using Twitter API requires a <a href="https://developer.twitter.com/en" target="_blank" rel="noopener noreferrer">developer account</a>. The "Essential" level was enough for this tiny project. As I plan to try other functionalities later on, I got the "Elevated" level.</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="creating-an-app-and-getting-your-keys-and-tokens">Creating an app and getting your keys and tokens<a href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets#creating-an-app-and-getting-your-keys-and-tokens" class="hash-link" aria-label="Direct link to Creating an app and getting your keys and tokens" title="Direct link to Creating an app and getting your keys and tokens">​</a></h5>
<p>Before we can dive into the API and play with the endpoints, we need some more configuration: <a href="https://developer.twitter.com/en/portal/apps/new" target="_blank" rel="noopener noreferrer">creating an app</a>.</p>
<blockquote>
<p>Note: keys generated cannot be displayed again, in case you forgot to write them somewhere, you can still regenerate them.</p>
</blockquote>
<p>In the "Settings" tab, the "OAuth 1.0a" must be activated, with "Read and write" permissions. The callback URI / Redirect URL can be your own github page.</p>
<p>In the Keys and tokens tab, you can now get your consumer keys and generate authentication tokens for your personal account.</p>
<hr>
<h1>Tweepy</h1>
<p>APIs can be used in most programming languages, and as Python is the one I am most comfortable with, I looked for a library that wraps the Twitter API for conveniency. I came across <a href="https://github.com/tweepy/tweepy" target="_blank" rel="noopener noreferrer">tweepy</a>.</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="credentials">Credentials<a href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets#credentials" class="hash-link" aria-label="Direct link to Credentials" title="Direct link to Credentials">​</a></h6>
<p>Your credentials can be stored in a yaml file to avoid hard-coding them in your python files (<strong>do not commit your keys!</strong>). For example in <code>delete-my-tweets.yaml</code>:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">delete-my-tweets-dev</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">consumer_key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">***********</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">consumer_secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">**************</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">access_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">*************************</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">access_token_secret</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">**********************</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">bearer_token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token important">********************************************</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then, you can load them using <a href="https://github.com/yaml/pyyaml" target="_blank" rel="noopener noreferrer">pyyaml</a>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># https://stackoverflow.com/a/1774043/13765085</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">with</span><span class="token plain"> </span><span class="token builtin">open</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">"delete-my-tweets.yaml"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"r"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> stream</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">try</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        parameters </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> yaml</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">safe_load</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">stream</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'delete-my-tweets-dev'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">except</span><span class="token plain"> yaml</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">YAMLError </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> exc</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">exc</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="initialize-client">Initialize client<a href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets#initialize-client" class="hash-link" aria-label="Direct link to Initialize client" title="Direct link to Initialize client">​</a></h5>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tweepy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">client </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> tweepy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Client</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bearer_token</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'bearer_token'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumer_key</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'consumer_key'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    consumer_secret</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'consumer_secret'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_token</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'access_token'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    access_token_secret</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">parameters</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'access_token_secret'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    wait_on_rate_limit</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># to automatically wait when rate is exceeded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="retrieve-users-tweets">Retrieve user's tweets<a href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets#retrieve-users-tweets" class="hash-link" aria-label="Direct link to Retrieve user's tweets" title="Direct link to Retrieve user's tweets">​</a></h5>
<p>To get the list of tweets from a user, it is required to provide the id associated with the account. To get this information, you can use the method <code>get_user</code> and provide your username.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">user </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_user</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">username</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'hugo_le_moine_'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can now retrieve the account's tweets. The method <code>get_user_tweets</code> allows to collect tweets 100 at a time using pagination: each call will return a maximum of <code>max_results</code> tweets, and provide a token <code>next_token</code> allowing to collect the next tweets by passing it as an argument to the next call.</p>
<blockquote>
<p>This method only allows to retrieve the most recent 3200 tweets.</p>
</blockquote>
<p>We can write a recursive function that will go dig until the no more <code>next_token</code> is provided, and return all the tweets as a list.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">collect_tweet_ids</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">next_token</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># timeline contains tweets and metadata about the user</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    timeline </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">get_users_tweets</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">id</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">user</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max_results</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">100</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        pagination_token</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">next_token</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># get list of tweets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    tweet_list</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> timeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># if a next page exists, append its results to the list of tweets</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'next_token'</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> timeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">meta</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        tweet_list </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> collect_tweet_ids</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">timeline</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">meta</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'next_token'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> tweet_list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We can now collect the tweets history:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tweets </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> collect_tweet_ids</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="delete-tweets">Delete tweets<a href="https://hugolmn.github.io/blog/2022/06/11/delete-my-tweets#delete-tweets" class="hash-link" aria-label="Direct link to Delete tweets" title="Direct link to Delete tweets">​</a></h5>
<p>Finally, we can use the tweet ids to delete them using the <code>delete_tweet</code> method.</p>
<blockquote>
<p><strong>Warning</strong>: twitter cap rate limits tweet deletion to 50 per 15 min window. Deleting all tweets can take a while, more than 8 hours in my case.</p>
</blockquote>
<p>I use <a href="https://github.com/tqdm/tqdm" target="_blank" rel="noopener noreferrer">tqdm</a> to display a progress bar.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> tqdm </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> tqdm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> tweet </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> tqdm</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tweets</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    client</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">delete_tweet</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tweet</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">id</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<p>That's it!! I can now resume using twitter with a seemingly blank account, except that I get to keep all my settings and followings. I learnt to use the Twitter API and it's python wrapper tweepy, not in depth, but I will quite likely get back to it in the future!</p>
<p>Has it been useful to you? Any faster way that you found? Any feedback will be appreciated, hit me up on twitter <a href="https://twitter.com/hugo_le_moine_" target="_blank" rel="noopener noreferrer">@hugo_le_moine_</a>!</p>]]></content>
        <author>
            <name>Hugo Le Moine</name>
            <uri>https://github.com/hugolmn</uri>
        </author>
        <category label="Python" term="Python"/>
        <category label="API" term="API"/>
        <category label="Twitter" term="Twitter"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[SNCF Open Data: found items - 2]]></title>
        <id>https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2</id>
        <link href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2"/>
        <updated>2020-07-28T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Data visualization using plotly]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="map-of-found-items">Map of found items<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#map-of-found-items" class="hash-link" aria-label="Direct link to Map of found items" title="Direct link to Map of found items">​</a></h2>
<p>Following a previous <a href="https://hugolmn.github.io/2020/06/27/sncf-found-items.html" target="_blank" rel="noopener noreferrer">article</a> analyzing monthly evolution as well as concentration of found items, here is another perspective on these data made available by the SNCF. Obviously, the higher the number of passengers, the higher the number of found items. Now, let's look into the details!</p>
<p>On this map are represented the number of found items per 100k passengers between 2015 and 2018. Only stations with more than 10 found items are shown.</p>
<div class="plotly-container"><iframe width="100%" height="700" frameborder="0" scrolling="no" src="/graphs/sncf-found-items-map.html"></iframe></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-can-we-conclude-from-this-visualization-">What can we conclude from this visualization ?<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#what-can-we-conclude-from-this-visualization-" class="hash-link" aria-label="Direct link to What can we conclude from this visualization ?" title="Direct link to What can we conclude from this visualization ?">​</a></h4>
<p>Clearly, there is a significant difference between the area of Paris/north of France, and anywhere else in the country. Nonetheless, one should avoid easy conclusion: are people more careful about their belongings or less prone to hand found items back ? The two options are possibly and even likely connected, but additional data are required to investigate. Perhaps in another part :)</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data">Data<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#data" class="hash-link" aria-label="Direct link to Data" title="Direct link to Data">​</a></h2>
<ul>
<li><a href="https://ressources.data.sncf.com/explore/dataset/frequentation-gares" target="_blank" rel="noopener noreferrer">SNCF : train station attendance</a></li>
<li><a href="https://ressources.data.sncf.com/explore/dataset/referentiel-gares-voyageurs" target="_blank" rel="noopener noreferrer">SNCF: train station list</a></li>
<li><a href="https://ressources.data.sncf.com/explore/dataset/objets-trouves-restitution" target="_blank" rel="noopener noreferrer">SNCF: found items</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="libraries">Libraries<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#libraries" class="hash-link" aria-label="Direct link to Libraries" title="Direct link to Libraries">​</a></h2>
<p>The following libraries are imported:</p>
<ul>
<li><a href="https://pandas.pydata.org/" target="_blank" rel="noopener noreferrer">pandas</a> and <a href="https://numpy.org/" target="_blank" rel="noopener noreferrer">numpy</a> for data processing</li>
<li><a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer">plotly</a>.colors to use a specific colorscale</li>
<li><a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer">plotly</a>.graph_object for data visualization</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">colors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph_objects </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="processing">Processing<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#processing" class="hash-link" aria-label="Direct link to Processing" title="Direct link to Processing">​</a></h2>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-reading-csv-files">1. Reading csv files<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#1-reading-csv-files" class="hash-link" aria-label="Direct link to 1. Reading csv files" title="Direct link to 1. Reading csv files">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_frequentation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/frequentation-gares.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_gares </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/referentiel-gares-voyageurs.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/objets-trouves-restitution.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These two dataframes contain contain the following data:</p>
<ul>
<li>
<p><code>df_frequentation</code>: train station attendance data</p>
</li>
<li>
<p><code>df_gares</code>: train station data, including latitude and longitude.</p>
</li>
<li>
<p><code>df_items</code>: found item data, including date and location.</p>
</li>
</ul>
<p>Sample data from <code>df_frequentation</code></p>
<table><thead><tr><th></th><th>Nom de la gare</th><th>Code UIC complet</th><th>Code postal</th><th>Segmentation DRG 2018</th><th>Total Voyageurs 2018</th><th>Total Voyageurs + Non voyageurs 2018</th><th>Total Voyageurs 2017</th><th>Total Voyageurs + Non voyageurs 2017</th><th>Total Voyageurs 2016</th><th>Total Voyageurs + Non voyageurs 2016</th><th>Total Voyageurs 2015</th><th>Total Voyageurs + Non voyageurs 2015</th></tr></thead><tbody><tr><td>0</td><td>Abancourt</td><td>87313759</td><td>60220</td><td>c</td><td>40228</td><td>40228</td><td>43760</td><td>43760</td><td>41096</td><td>41096.551614</td><td>39720</td><td>39720</td></tr><tr><td>1</td><td>Agay</td><td>87757559</td><td>83530</td><td>c</td><td>15093</td><td>15093</td><td>14154</td><td>14154</td><td>19240</td><td>19240.514370</td><td>19121</td><td>19121</td></tr><tr><td>2</td><td>Agde</td><td>87781278</td><td>34300</td><td>a</td><td>588297</td><td>735372</td><td>697091</td><td>871364</td><td>660656</td><td>825820.929253</td><td>662516</td><td>828146</td></tr><tr><td>3</td><td>Agonac</td><td>87595157</td><td>24460</td><td>c</td><td>1492</td><td>1492</td><td>1583</td><td>1583</td><td>1134</td><td>1134.699996</td><td>1127</td><td>1127</td></tr><tr><td>4</td><td>Aigrefeuille Le Thou</td><td>87485193</td><td>17290</td><td>c</td><td>18670</td><td>18670</td><td>14513</td><td>14513</td><td>266</td><td>266.157144</td><td>0</td><td>0</td></tr></tbody></table>
<p>Sample data from <code>df_gares</code></p>
<table><thead><tr><th></th><th>Code plate-forme</th><th>Intitulé gare</th><th>Intitulé fronton de gare</th><th>Gare DRG</th><th>Gare étrangère</th><th>Agence gare</th><th>Région SNCF</th><th>Unité gare</th><th>UT</th><th>Nbre plateformes</th><th>...</th><th>Longitude WGS84</th><th>Latitude WGS84</th><th>Code UIC</th><th>TVS</th><th>Segment DRG</th><th>Niveau de service</th><th>SOP</th><th>RG</th><th>Date fin validité plateforme</th><th>WGS 84</th></tr></thead><tbody><tr><td>0</td><td>00007-1</td><td>Bourg-Madame</td><td>Bourg-Madame</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>BOURG MADAME GARE</td><td>1</td><td>...</td><td>1.948670</td><td>42.432407</td><td>87784876</td><td>BMD</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.4324069,1.9486704</td></tr><tr><td>1</td><td>00014-1</td><td>Bolquère - Eyne</td><td>Bolquère - Eyne</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>BOLQUERE EYNE GARE</td><td>1</td><td>...</td><td>2.087559</td><td>42.497873</td><td>87784801</td><td>BQE</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.4978734,2.0875591</td></tr><tr><td>2</td><td>00015-1</td><td>Mont-Louis - La Cabanasse</td><td>Mont-Louis - La Cabanasse</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>MONT LOUIS LA CABANASSE GARE</td><td>1</td><td>...</td><td>2.113138</td><td>42.502090</td><td>87784793</td><td>MTC</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.5020902,2.1131379</td></tr></tbody></table>
<p>Sampel data from <code>df_items</code></p>
<table><thead><tr><th></th><th>Date</th><th>Date et heure de restitution</th><th>Gare</th><th>Code UIC</th><th>Nature d'objets</th><th>Type d'objets</th><th>Type d'enregistrement</th></tr></thead><tbody><tr><td>0</td><td>2014-03-09T14:25:29+01:00</td><td>NaN</td><td>Paris Montparnasse</td><td>87391003.0</td><td>Manteau, veste, blazer, parka, blouson, cape</td><td>Vêtements, chaussures</td><td>Objet trouvé</td></tr><tr><td>1</td><td>2018-01-23T15:07:32+01:00</td><td>NaN</td><td>Saint-Étienne Châteaucreux</td><td>87726000.0</td><td>Montre</td><td>Bijoux, montres</td><td>Objet trouvé</td></tr><tr><td>2</td><td>2018-02-06T15:35:49+01:00</td><td>NaN</td><td>Rennes</td><td>87471003.0</td><td>Clés, porte-clés</td><td>Clés, porte-clés, badge magnétique</td><td>Objet trouvé</td></tr></tbody></table>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-merging-dataframes">2. Merging dataframes<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#2-merging-dataframes" class="hash-link" aria-label="Direct link to 2. Merging dataframes" title="Direct link to 2. Merging dataframes">​</a></h4>
<p>The three dataframes have a column identifier: the UIC code ("Union Internationale des Chemins de fer", International Union of Railways in french). We can merge them based on this unique value for each station.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_gares</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_frequentation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    left_on</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Code UIC'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right_on</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Code UIC complet'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    how</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'inner'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_items</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> on</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Code UIC'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> how</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'right'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-conversion-to-datetime">3. Conversion to datetime<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#3-conversion-to-datetime" class="hash-link" aria-label="Direct link to 3. Conversion to datetime" title="Direct link to 3. Conversion to datetime">​</a></h4>
<p>For now, the DataFrame has a Date column, but was not assigned any particular format.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtype</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; dtype('O')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</blockquote>
<p>In order to have a standardized datetime, <code>pandas.to_datetime</code> can be applied to get a datetime, and then <code>tz_convert</code> to make it french time.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Date'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> utc</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tz_convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Europe/Paris'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-filtering-dates">4. Filtering dates<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#4-filtering-dates" class="hash-link" aria-label="Direct link to 4. Filtering dates" title="Direct link to 4. Filtering dates">​</a></h4>
<p>As I want to analyze the number of found items according to the number of passengers, I must filter out data which is not in the period 2015-2018 as these are the only years for which the number of passengers is available.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">loc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2015</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2018</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-total-number-of-passengers-per-station">5. Total number of passengers per station<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#5-total-number-of-passengers-per-station" class="hash-link" aria-label="Direct link to 5. Total number of passengers per station" title="Direct link to 5. Total number of passengers per station">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Passengers'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2018'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2017'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2016'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2015'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-grouping-data-by-train-station">6. Grouping data by train station<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#6-grouping-data-by-train-station" class="hash-link" aria-label="Direct link to 6. Grouping data by train station" title="Direct link to 6. Grouping data by train station">​</a></h4>
<p>Data is grouped by station name, geographical coordinates are kept, as well as the count of found items, and the number of passengers.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Intitulé gare"</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">agg</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'Longitude WGS84'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'first'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">'Latitude WGS84'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'first'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">'Nature d\'objets'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token string" style="color:#e3116c">'Passengers'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'first'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">columns</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'Nature d\'objets'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'item_count'</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-count-per-100k">7. Count per 100k<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#7-count-per-100k" class="hash-link" aria-label="Direct link to 7. Count per 100k" title="Direct link to 7. Count per 100k">​</a></h4>
<p>In this blog post, the focus is put on the ratio item/pax. A straightforward division would lead to number hard to imagine. Therefore, using a ratio per 100k passengers is more interesting. I restricted the selection to stations having at least 10 found items .</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'count_per_100kpax'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">item_count </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Passengers </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'count_per_100kpax'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ascending</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">item_count </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-creation-of-categories">8. Creation of categories<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#8-creation-of-categories" class="hash-link" aria-label="Direct link to 8. Creation of categories" title="Direct link to 8. Creation of categories">​</a></h4>
<p>To group data by category on the map, we need to bin them. I chose a standard quantile binning with 20% of data in each bin.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'group'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">qcut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'count_per_100kpax'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> q</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">linspace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9-what-we-have-so-far">9. What we have so far<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#9-what-we-have-so-far" class="hash-link" aria-label="Direct link to 9. What we have so far" title="Direct link to 9. What we have so far">​</a></h4>
<table><thead><tr><th>Intitulé gare</th><th>Longitude WGS84</th><th>Latitude WGS84</th><th>item_count</th><th>Passengers</th><th>count_per_100kpax</th><th>category</th></tr></thead><tbody><tr><td>Versailles Rive Droite</td><td>2.134752</td><td>48.809653</td><td>39</td><td>21309519.0</td><td>0.183017</td><td>(0.182, 3.623]</td></tr><tr><td>Poissy</td><td>2.041368</td><td>48.932901</td><td>80</td><td>43120958.0</td><td>0.185525</td><td>(0.182, 3.623]</td></tr><tr><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><td>Hendaye</td><td>-1.781724</td><td>43.353132</td><td>2873</td><td>1422622.0</td><td>201.951045</td><td>(24.664, 323.36]</td></tr><tr><td>Le Croisic</td><td>-2.507442</td><td>47.289836</td><td>1358</td><td>419966.0</td><td>323.359510</td><td>(24.664, 323.36]</td></tr></tbody></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="visualization">Visualization<a href="https://hugolmn.github.io/blog/2020/07/28/sncf-found-items-2#visualization" class="hash-link" aria-label="Direct link to Visualization" title="Direct link to Visualization">​</a></h2>
<p>Now that all the processing part is completed, we can proceed to the  visualization.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">colors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sequential</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Inferno </span><span class="token comment" style="color:#999988;font-style:italic"># Custom colormap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># One scattermapbox per group</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> group </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">categories</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">group </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> group</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Scattermapbox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lat</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Latitude WGS84'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            lon</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Longitude WGS84'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            text</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            marker</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                color</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">colors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'count_per_100kpax'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sizemin</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sizeref</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">.35</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                sizemode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'area'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                opacity</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">.8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            meta</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'item_count'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            hovertemplate</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"%{text}"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&lt;br&gt;"</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Found items: %{meta}"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&lt;br&gt;"</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Per 100kPax: "</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"%{marker.size:.1f}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            name</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f'&gt; </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cat</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">left</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">.0f</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> per 100kPax'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Defining map style, margins, and original position</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapbox_style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"open-street-map"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#title='Passengers per french train station in 2018',</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'l'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'r'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'t'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapbox</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        center</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'lon'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.39</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'lat'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">47.09</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zoom</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Legend layout</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">legend</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'orientation'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'h'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'y'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Link to the <a href="https://github.com/hugolmn/dataviz/blob/master/SNCF_found_item_2.ipynb" target="_blank" rel="noopener noreferrer">Jupyter notebook</a>.</p>]]></content>
        <author>
            <name>Hugo Le Moine</name>
            <uri>https://github.com/hugolmn</uri>
        </author>
        <category label="Data Visualization" term="Data Visualization"/>
        <category label="Python" term="Python"/>
        <category label="plotly" term="plotly"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[Covid19 and Google Trends]]></title>
        <id>https://hugolmn.github.io/blog/2020/07/08/usa-covid-google-trends</id>
        <link href="https://hugolmn.github.io/blog/2020/07/08/usa-covid-google-trends"/>
        <updated>2020-07-08T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Trend anaysis between covid19 cases and Google searches]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="usa-covid19-cases-vs-google-trends">USA Covid19 Cases vs. Google Trends<a href="https://hugolmn.github.io/blog/2020/07/08/usa-covid-google-trends#usa-covid19-cases-vs-google-trends" class="hash-link" aria-label="Direct link to USA Covid19 Cases vs. Google Trends" title="Direct link to USA Covid19 Cases vs. Google Trends">​</a></h2>
<p>Based on user searches, <a href="https://www.google.org/flutrends/about/" target="_blank" rel="noopener noreferrer">Google Flu</a> tried to estimate flu prevalence among populations. In this simple visualization I try to use a similar, yet simplified approach. Below are compared USA reported covid19 cases against Google Trends popularity for "Coronavirus" and "Worldometer" (which is a website used worldwide to track this pandemic).</p>
<iframe width="100%" height="400" frameborder="0" scrolling="no" src="//plotly.com/~hugolmn/55.embed?link=false&amp;autosize=true&amp;modebar=false"></iframe>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="timeline">Timeline<a href="https://hugolmn.github.io/blog/2020/07/08/usa-covid-google-trends#timeline" class="hash-link" aria-label="Direct link to Timeline" title="Direct link to Timeline">​</a></h2>
<ul>
<li>January 2020: quick spread in China</li>
<li>Mid-February : spread to Europe</li>
<li>"Coronavirus" popularity peaks on 15th March, when USA cases growth rate is maximal.</li>
<li>"Worldometer" popularity peaks two weeks later.</li>
<li>11th April: USA 7-day moving average peaks.</li>
<li>31th May: USA 7-day moving average bottoms to a 2-month low.</li>
<li>Since June: cases are up to new daily records, but popularity of "Coronavirus" remains low.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data">Data<a href="https://hugolmn.github.io/blog/2020/07/08/usa-covid-google-trends#data" class="hash-link" aria-label="Direct link to Data" title="Direct link to Data">​</a></h2>
<ul>
<li><a href="https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/cases-in-us.html" target="_blank" rel="noopener noreferrer">CDC USA</a></li>
<li><a href="https://trends.google.com/trends/explore?date=2020-01-01%202020-12-31&amp;geo=US&amp;q=%2Fm%2F01cpyy" target="_blank" rel="noopener noreferrer">Google Trends</a></li>
</ul>
<p>Link to the <a href="https://github.com/hugolmn/dataviz/blob/master/USA-Google-Trends.ipynb" target="_blank" rel="noopener noreferrer">Jupyter notebook</a>.</p>]]></content>
        <author>
            <name>Hugo Le Moine</name>
            <uri>https://github.com/hugolmn</uri>
        </author>
        <category label="Data Visualization" term="Data Visualization"/>
        <category label="Python" term="Python"/>
        <category label="plotly" term="plotly"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[SNCF Open Data: found items - 1]]></title>
        <id>https://hugolmn.github.io/blog/2020/06/27/sncf-found-items</id>
        <link href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items"/>
        <updated>2020-06-27T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Data visualization using plotly]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="monthly-found-items-in-french-train-stations">Monthly found items in french train stations<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#monthly-found-items-in-french-train-stations" class="hash-link" aria-label="Direct link to Monthly found items in french train stations" title="Direct link to Monthly found items in french train stations">​</a></h2>
<p>We can view found items as a proxy for passenger traffic. On this first chart, we can clearly identify a few traffic disruptions:</p>
<ul>
<li>April 2018 to June 2018 : discontinuous strike against project to reform SNCF.</li>
<li>December 2019 : strike against pension reform.</li>
<li>March 2020 to June 2020 : Covid-19 restrictions.</li>
</ul>
<p>We can also observe a peak in July each year, corresponding to summer vacations for most people.</p>
<iframe height="400" width="100%" frameborder="0" scrolling="no" src="//plotly.com/~hugolmn/21.embed?link=false&amp;autosize=true"></iframe>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="18-of-stations-represent-80-of-found-items">18% of stations represent 80% of found items<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#18-of-stations-represent-80-of-found-items" class="hash-link" aria-label="Direct link to 18% of stations represent 80% of found items" title="Direct link to 18% of stations represent 80% of found items">​</a></h2>
<iframe height="600" width="100%" frameborder="0" scrolling="no" src="//plotly.com/~hugolmn/14.embed?link=false&amp;autosize=true"></iframe>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data">Data<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#data" class="hash-link" aria-label="Direct link to Data" title="Direct link to Data">​</a></h2>
<ul>
<li><a href="https://ressources.data.sncf.com/explore/dataset/referentiel-gares-voyageurs" target="_blank" rel="noopener noreferrer">SNCF: train station list</a></li>
<li><a href="https://ressources.data.sncf.com/explore/dataset/objets-trouves-restitution" target="_blank" rel="noopener noreferrer">SNCF: found items</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="libraries">Libraries<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#libraries" class="hash-link" aria-label="Direct link to Libraries" title="Direct link to Libraries">​</a></h2>
<p>The following libraries are imported:</p>
<ul>
<li><a href="https://pandas.pydata.org/" target="_blank" rel="noopener noreferrer">pandas</a> and <a href="https://numpy.org/" target="_blank" rel="noopener noreferrer">numpy</a> for data processing</li>
<li><a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer">plotly</a>.colors to use a specific colorscale</li>
<li><a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer">plotly</a>.graph_object for data visualization</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">colors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph_objects </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="processing">Processing<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#processing" class="hash-link" aria-label="Direct link to Processing" title="Direct link to Processing">​</a></h2>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-reading-csv-files">1. Reading csv files<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#1-reading-csv-files" class="hash-link" aria-label="Direct link to 1. Reading csv files" title="Direct link to 1. Reading csv files">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_gares </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/referentiel-gares-voyageurs.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_items </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/objets-trouves-restitution.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These two dataframes contain contain the following data:</p>
<ul>
<li><code>df_gares</code>: train station data, including latitude and longitude.</li>
<li><code>df_items</code>: found item data, including date and location.</li>
</ul>
<p>Sample data from <code>df_gares</code></p>
<table><thead><tr><th></th><th>Code plate-forme</th><th>Intitulé gare</th><th>Intitulé fronton de gare</th><th>Gare DRG</th><th>Gare étrangère</th><th>Agence gare</th><th>Région SNCF</th><th>Unité gare</th><th>UT</th><th>Nbre plateformes</th><th>...</th><th>Longitude WGS84</th><th>Latitude WGS84</th><th>Code UIC</th><th>TVS</th><th>Segment DRG</th><th>Niveau de service</th><th>SOP</th><th>RG</th><th>Date fin validité plateforme</th><th>WGS 84</th></tr></thead><tbody><tr><td>0</td><td>00007-1</td><td>Bourg-Madame</td><td>Bourg-Madame</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>BOURG MADAME GARE</td><td>1</td><td>...</td><td>1.948670</td><td>42.432407</td><td>87784876</td><td>BMD</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.4324069,1.9486704</td></tr><tr><td>1</td><td>00014-1</td><td>Bolquère - Eyne</td><td>Bolquère - Eyne</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>BOLQUERE EYNE GARE</td><td>1</td><td>...</td><td>2.087559</td><td>42.497873</td><td>87784801</td><td>BQE</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.4978734,2.0875591</td></tr><tr><td>2</td><td>00015-1</td><td>Mont-Louis - La Cabanasse</td><td>Mont-Louis - La Cabanasse</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>MONT LOUIS LA CABANASSE GARE</td><td>1</td><td>...</td><td>2.113138</td><td>42.502090</td><td>87784793</td><td>MTC</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.5020902,2.1131379</td></tr></tbody></table>
<p>Sampel data from <code>df_items</code></p>
<table><thead><tr><th></th><th>Date</th><th>Date et heure de restitution</th><th>Gare</th><th>Code UIC</th><th>Nature d'objets</th><th>Type d'objets</th><th>Type d'enregistrement</th></tr></thead><tbody><tr><td>0</td><td>2014-03-09T14:25:29+01:00</td><td>NaN</td><td>Paris Montparnasse</td><td>87391003.0</td><td>Manteau, veste, blazer, parka, blouson, cape</td><td>Vêtements, chaussures</td><td>Objet trouvé</td></tr><tr><td>1</td><td>2018-01-23T15:07:32+01:00</td><td>NaN</td><td>Saint-Étienne Châteaucreux</td><td>87726000.0</td><td>Montre</td><td>Bijoux, montres</td><td>Objet trouvé</td></tr><tr><td>2</td><td>2018-02-06T15:35:49+01:00</td><td>NaN</td><td>Rennes</td><td>87471003.0</td><td>Clés, porte-clés</td><td>Clés, porte-clés, badge magnétique</td><td>Objet trouvé</td></tr></tbody></table>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-conversion-to-datetime">2. Conversion to datetime<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#2-conversion-to-datetime" class="hash-link" aria-label="Direct link to 2. Conversion to datetime" title="Direct link to 2. Conversion to datetime">​</a></h4>
<p>For now, the DataFrame has a Date column, but was not assigned any particular format.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dtype</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&gt;&gt; dtype('O')</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</blockquote>
<p>In order to have a standardized datetime, <code>pandas.to_datetime</code>can be applied to get a datetime, and then <code>tz_convert</code>to make it french time.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Date'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> utc</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">True</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">tz_convert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Europe/Paris'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-filtering-dates">3. Filtering dates<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#3-filtering-dates" class="hash-link" aria-label="Direct link to 3. Filtering dates" title="Direct link to 3. Filtering dates">​</a></h4>
<p>To know when data collection has actually been put into place, let's analyse dates contained in the DataFrame.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">value_counts</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_index</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<table><thead><tr><th>Date</th><th>Count</th></tr></thead><tbody><tr><td>2013</td><td>15698</td></tr><tr><td>2014</td><td>102793</td></tr><tr><td>2015</td><td>111706</td></tr><tr><td>2016</td><td>107595</td></tr><tr><td>2017</td><td>107662</td></tr><tr><td>2018</td><td>116308</td></tr><tr><td>2019</td><td>122637</td></tr><tr><td>2020</td><td>26143</td></tr></tbody></table>
<p>To keep consistency, I decided to drop data from 2013: data collection may have not started everywhere, and had definitely not started in January 2013. If we want to dig deeper into the data and check correlations with passenger count, it would be difficult to achieve if data are not complete. Therefore only data collected from 2014 onwards will be kept:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2014</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5-grouping-data-by-year-and-month">5. Grouping data by year and month<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#5-grouping-data-by-year-and-month" class="hash-link" aria-label="Direct link to 5. Grouping data by year and month" title="Direct link to 5. Grouping data by year and month">​</a></h4>
<p>In the first chart, I wanted to plot found item count for each month in the dataset. To do so, we need to group by year, then month.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_months </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">year</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">dt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">month</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The result is the following:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token number" style="color:#36acaa">2014</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">5788</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">5815</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">7012</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">8543</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">8657</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2020</span><span class="token plain">  </span><span class="token number" style="color:#36acaa">2</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">9271</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">3</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">4473</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">4</span><span class="token plain">         </span><span class="token number" style="color:#36acaa">72</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">5</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">1386</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">       </span><span class="token number" style="color:#36acaa">3649</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we need to get the index back to datetime, combining years and months.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_months</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_months</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">lambda</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">to_datetime</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'-'</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6-grouping-data-by-train-station">6. Grouping data by train station<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#6-grouping-data-by-train-station" class="hash-link" aria-label="Direct link to 6. Grouping data by train station" title="Direct link to 6. Grouping data by train station">​</a></h4>
<p>The second chart was made after grouping by train station. It can be achieved by the following instructions:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_grouped </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">groupby</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Gare'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">count</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Date</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rename</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Count'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sort_values</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ascending</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">False</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This will first group by train station name, then apply a count aggregation, keep the Date renamed as Count, and values will be sorted from greatest to lowest count.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7-pareto">7. Pareto<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#7-pareto" class="hash-link" aria-label="Direct link to 7. Pareto" title="Direct link to 7. Pareto">​</a></h4>
<p>The <code>df_grouped</code>DataFrame allows us to demonstrate an application of the Pareto priciple. The following lines are doing:</p>
<ul>
<li>Cumulative found item count of <code>df_grouped</code></li>
<li>Sum of all items in <code>df_grouped</code></li>
<li>Assigning booleans to cumulative counts below 80% of the total number of items, and counting them</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pareto </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_grouped</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cumsum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> df_grouped</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.8</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The <code>df_grouped</code>DataFrame contains 181 train stations, and 32  (18%) of them account for 80% of the total count of found items.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8-filtering-grouped-data">8. Filtering grouped data<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#8-filtering-grouped-data" class="hash-link" aria-label="Direct link to 8. Filtering grouped data" title="Direct link to 8. Filtering grouped data">​</a></h4>
<p>Using the Pareto principle described above, I filtered <code>df_grouped</code>to keep the first 32 rows for visualization purpose.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_grouped </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_grouped</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">pareto</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="visualization">Visualization<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#visualization" class="hash-link" aria-label="Direct link to Visualization" title="Direct link to Visualization">​</a></h2>
<p>Now that all the processing part is completed, we can proceed to visualization.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-monthly-found-items">1. Monthly found items<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#1-monthly-found-items" class="hash-link" aria-label="Direct link to 1. Monthly found items" title="Direct link to 1. Monthly found items">​</a></h3>
<p>The first chart is simply a bar chart of the total count of found items per month. <code>x</code> will therefore be the index of the dataframe <code>df_months</code>, and <code>y</code>  will be the sum of all found items found for the associated months.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_months</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_months</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hoverinfo</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"x+y"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        marker_color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"#007bff"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then, y axis title is added, as well as margins to enhance the result.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yaxis</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Found items in train stations"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> titlefont</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'l'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'r'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'t'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-found-items-per-train-station">2. Found items per train station<a href="https://hugolmn.github.io/blog/2020/06/27/sncf-found-items#2-found-items-per-train-station" class="hash-link" aria-label="Direct link to 2. Found items per train station" title="Direct link to 2. Found items per train station">​</a></h3>
<p>The second chart is also a bar chart. The data plotted are the counts of found items in each train station. As mentioned in the processing part, only the first 32 stations are displayed, ordered by number of found items.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Bar</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        x</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">arange</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token builtin">len</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_grouped</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        y</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_grouped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_grouped</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">index</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        meta </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_grouped</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hoverinfo</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"text+y"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Found items"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        marker_color</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"#007bff"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The final step is adjusting the layout: margins, axis titles and log scale for the y axis.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'l'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'r'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'t'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">250</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    xaxis</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">tickangle</span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">90</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               tickfont</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'size'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    yaxis</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">title</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"Found items per station"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               </span><span class="token builtin">type</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"log"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               titlefont</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">size</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">16</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Link to the <a href="https://github.com/hugolmn/dataviz/blob/master/SNCF_found_item_1.ipynb" target="_blank" rel="noopener noreferrer">Jupyter notebook</a>.</p>]]></content>
        <author>
            <name>Hugo Le Moine</name>
            <uri>https://github.com/hugolmn</uri>
        </author>
        <category label="Data Visualization" term="Data Visualization"/>
        <category label="Python" term="Python"/>
        <category label="plotly" term="plotly"/>
    </entry>
    <entry>
        <title type="html"><![CDATA[SNCF Open Data: train station attendance]]></title>
        <id>https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance</id>
        <link href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance"/>
        <updated>2020-06-17T00:00:00.000Z</updated>
        <summary type="html"><![CDATA[Geo-visualization of train stations]]></summary>
        <content type="html"><![CDATA[<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="passengers-per-french-train-station-in-2018">Passengers per french train station in 2018<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#passengers-per-french-train-station-in-2018" class="hash-link" aria-label="Direct link to Passengers per french train station in 2018" title="Direct link to Passengers per french train station in 2018">​</a></h2>
<div class="plotly-container"><iframe width="100%" height="700" frameborder="0" scrolling="no" src="/graphs/sncf-train-stations.html"></iframe></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data">Data<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#data" class="hash-link" aria-label="Direct link to Data" title="Direct link to Data">​</a></h2>
<ul>
<li><a href="https://ressources.data.sncf.com/explore/dataset/frequentation-gares" target="_blank" rel="noopener noreferrer">SNCF : train station attendance</a></li>
<li><a href="https://ressources.data.sncf.com/explore/dataset/referentiel-gares-voyageurs" target="_blank" rel="noopener noreferrer">SNCF : train station list</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="libraries">Libraries<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#libraries" class="hash-link" aria-label="Direct link to Libraries" title="Direct link to Libraries">​</a></h2>
<p>The following libraries are imported:</p>
<ul>
<li><a href="https://pandas.pydata.org/" target="_blank" rel="noopener noreferrer">pandas</a> and <a href="https://numpy.org/" target="_blank" rel="noopener noreferrer">numpy</a> for data processing</li>
<li><a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer">plotly</a>.colors to use a specific color scale</li>
<li><a href="https://plotly.com/python/" target="_blank" rel="noopener noreferrer">plotly</a>.graph_object for data visualization</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> pandas </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> pd						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> numpy </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> np						</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">colors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">graph_objects </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="processing">Processing<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#processing" class="hash-link" aria-label="Direct link to Processing" title="Direct link to Processing">​</a></h2>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-reading-csv-files">1. Reading csv files<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#1-reading-csv-files" class="hash-link" aria-label="Direct link to 1. Reading csv files" title="Direct link to 1. Reading csv files">​</a></h4>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df_frequentation </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/frequentation-gares.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">df_gares </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">read_csv</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'data/referentiel-gares-voyageurs.csv'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sep</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">';'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sample data from df_frequentation</p>
<table><thead><tr><th></th><th>Nom de la gare</th><th>Code UIC complet</th><th>Code postal</th><th>Segmentation DRG 2018</th><th>Total Voyageurs 2018</th><th>Total Voyageurs + Non voyageurs 2018</th><th>Total Voyageurs 2017</th><th>Total Voyageurs + Non voyageurs 2017</th><th>Total Voyageurs 2016</th><th>Total Voyageurs + Non voyageurs 2016</th><th>Total Voyageurs 2015</th><th>Total Voyageurs + Non voyageurs 2015</th></tr></thead><tbody><tr><td>0</td><td>Abancourt</td><td>87313759</td><td>60220</td><td>c</td><td>40228</td><td>40228</td><td>43760</td><td>43760</td><td>41096</td><td>41096.551614</td><td>39720</td><td>39720</td></tr><tr><td>1</td><td>Agay</td><td>87757559</td><td>83530</td><td>c</td><td>15093</td><td>15093</td><td>14154</td><td>14154</td><td>19240</td><td>19240.514370</td><td>19121</td><td>19121</td></tr><tr><td>2</td><td>Agde</td><td>87781278</td><td>34300</td><td>a</td><td>588297</td><td>735372</td><td>697091</td><td>871364</td><td>660656</td><td>825820.929253</td><td>662516</td><td>828146</td></tr><tr><td>3</td><td>Agonac</td><td>87595157</td><td>24460</td><td>c</td><td>1492</td><td>1492</td><td>1583</td><td>1583</td><td>1134</td><td>1134.699996</td><td>1127</td><td>1127</td></tr><tr><td>4</td><td>Aigrefeuille Le Thou</td><td>87485193</td><td>17290</td><td>c</td><td>18670</td><td>18670</td><td>14513</td><td>14513</td><td>266</td><td>266.157144</td><td>0</td><td>0</td></tr></tbody></table>
<p>Sample data from df_gares</p>
<table><thead><tr><th></th><th>Code plate-forme</th><th>Intitulé gare</th><th>Intitulé fronton de gare</th><th>Gare DRG</th><th>Gare étrangère</th><th>Agence gare</th><th>Région SNCF</th><th>Unité gare</th><th>UT</th><th>Nbre plateformes</th><th>...</th><th>Longitude WGS84</th><th>Latitude WGS84</th><th>Code UIC</th><th>TVS</th><th>Segment DRG</th><th>Niveau de service</th><th>SOP</th><th>RG</th><th>Date fin validité plateforme</th><th>WGS 84</th></tr></thead><tbody><tr><td>0</td><td>00007-1</td><td>Bourg-Madame</td><td>Bourg-Madame</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>BOURG MADAME GARE</td><td>1</td><td>...</td><td>1.948670</td><td>42.432407</td><td>87784876</td><td>BMD</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.4324069,1.9486704</td></tr><tr><td>1</td><td>00014-1</td><td>Bolquère - Eyne</td><td>Bolquère - Eyne</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>BOLQUERE EYNE GARE</td><td>1</td><td>...</td><td>2.087559</td><td>42.497873</td><td>87784801</td><td>BQE</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.4978734,2.0875591</td></tr><tr><td>2</td><td>00015-1</td><td>Mont-Louis - La Cabanasse</td><td>Mont-Louis - La Cabanasse</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>MONT LOUIS LA CABANASSE GARE</td><td>1</td><td>...</td><td>2.113138</td><td>42.502090</td><td>87784793</td><td>MTC</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.5020902,2.1131379</td></tr><tr><td>3</td><td>00020-1</td><td>Thuès les Bains</td><td>Thuès les Bains</td><td>True</td><td>False</td><td>Agence Grand Sud</td><td>REGION LANGUEDOC-ROUSSILLON</td><td>UG Languedoc Roussillon</td><td>THUES LES BAINS GARE</td><td>1</td><td>...</td><td>2.249094</td><td>42.528801</td><td>87784744</td><td>THB</td><td>c</td><td>1.0</td><td>NaN</td><td>GARES C LANGUEDOC ROUSSILLON</td><td>NaN</td><td>42.5288009,2.249094</td></tr></tbody></table>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-merging-dataframes">2. Merging dataframes<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#2-merging-dataframes" class="hash-link" aria-label="Direct link to 2. Merging dataframes" title="Direct link to 2. Merging dataframes">​</a></h4>
<p>The UIC Code is a unique ID for train stations. However, the column names are different in both files, so it's mandatory so specify the <strong><code>left_on</code></strong> and <strong><code>right_on</code></strong> arguments.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df_gares</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">merge</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_frequentation</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    left_on</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Code UIC'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    right_on</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Code UIC complet'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    how</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'inner'</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3-filtering">3. Filtering<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#3-filtering" class="hash-link" aria-label="Direct link to 3. Filtering" title="Direct link to 3. Filtering">​</a></h4>
<p>In order to avoid keeping small train stations, I chose to filter out stations with attendance below 1000 passengers in 2018. For visualization purpose, I added a column holding the square root of the number of passengers per station</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2018'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1000</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4-adding-a-category-column">4. Adding a category column<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#4-adding-a-category-column" class="hash-link" aria-label="Direct link to 4. Adding a category column" title="Direct link to 4. Adding a category column">​</a></h4>
<p>By using <code>pandas.cut</code> data can be split into categories according to total number of passengers. This will allow to plot with a different color for each category.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'category'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> pd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2018'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bins</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1e4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e6</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e7</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">inf</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="visualization">Visualization<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#visualization" class="hash-link" aria-label="Direct link to Visualization" title="Direct link to Visualization">​</a></h2>
<p><a href="https://plotly.com/" target="_blank" rel="noopener noreferrer">Plotly</a> is a handy tool when it comes to creating interactive graphs and plots, that you can embed in other websites.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1-scatter-mapbox">1. Scatter Mapbox<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#1-scatter-mapbox" class="hash-link" aria-label="Direct link to 1. Scatter Mapbox" title="Direct link to 1. Scatter Mapbox">​</a></h4>
<p>Data contain latitude and longitude: these will be used to plot train stations on the map. The size of the bubbles will depend on the square root of the number of passengers in 2018. A different trace is added for each of the categories defined above. Finally, information shown on mouse-hovering is defined using <code>hovertemplate</code>.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Figure</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">colors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> plotly</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">colors</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sequential</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Viridis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> i</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cat </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">enumerate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">category</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">cat</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">categories</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    df_sub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> df</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">df</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">category </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> cat</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">add_trace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">go</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Scattermapbox</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lat</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Latitude WGS84'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        lon</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Longitude WGS84'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        text</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Intitulé gare'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        marker</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            color</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">colors</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">i</span><span class="token operator" style="color:#393A34">+</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            size</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2018 sqrt'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sizemin</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sizeref</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            sizemode</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'area'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            opacity</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">.8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        meta</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">df_sub</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'Total Voyageurs 2018'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hovertemplate</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"%{text}"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"&lt;br&gt;"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Passengers: %{meta}"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        name</span><span class="token operator" style="color:#393A34">=</span><span class="token string-interpolation string" style="color:#e3116c">f'&gt; </span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">cat</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">left</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">:</span><span class="token string-interpolation interpolation format-spec">1.0e</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c"> passengers'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2-layout">2. Layout<a href="https://hugolmn.github.io/blog/2020/06/17/sncf-train-station-attendance#2-layout" class="hash-link" aria-label="Direct link to 2. Layout" title="Direct link to 2. Layout">​</a></h4>
<p>The last step is adding the background map, the title, margins around the plot, and the initial position &amp; zoom.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">fig</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">update_layout</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapbox_style</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"open-street-map"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    title</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">'Passengers per french train station in 2018'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    margin</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'l'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'r'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'t'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'b'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mapbox</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">dict</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        center</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">'lon'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2.39</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'lat'</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">47.09</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        zoom</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">4</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Link to the <a href="https://github.com/hugolmn/dataviz/blob/master/SNCF_traffic.ipynb" target="_blank" rel="noopener noreferrer">Jupyter notebook</a>.</p>]]></content>
        <author>
            <name>Hugo Le Moine</name>
            <uri>https://github.com/hugolmn</uri>
        </author>
        <category label="Data Visualization" term="Data Visualization"/>
        <category label="Python" term="Python"/>
        <category label="plotly" term="plotly"/>
    </entry>
</feed>