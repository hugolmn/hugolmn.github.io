"use strict";(self.webpackChunkdocusaurus_test=self.webpackChunkdocusaurus_test||[]).push([[1477],{10:e=>{e.exports=JSON.parse('{"blogPosts":[{"id":"/2022/06/11/delete-my-tweets","metadata":{"permalink":"/blog/2022/06/11/delete-my-tweets","editUrl":"https://github.com/hugolmn/hugolmn.github.io/tree/main/blog/2022-06-11-delete-my-tweets.md","source":"@site/blog/2022-06-11-delete-my-tweets.md","title":"Twitter API - Delete my tweets!","description":"I reset my account using twitter API, to delete all my existing tweets.","date":"2022-06-11T00:00:00.000Z","formattedDate":"June 11, 2022","tags":[{"label":"Python","permalink":"/blog/tags/python"},{"label":"API","permalink":"/blog/tags/api"},{"label":"Twitter","permalink":"/blog/tags/twitter"}],"readingTime":3.565,"hasTruncateMarker":false,"authors":[{"name":"Hugo Le Moine","title":"Data Scientist","url":"https://github.com/hugolmn","imageURL":"https://github.com/hugolmn.png","key":"hugo"}],"frontMatter":{"title":"Twitter API - Delete my tweets!","tags":["Python","API","Twitter"],"authors":"hugo","style":"border","color":"primary","description":"I reset my account using twitter API, to delete all my existing tweets."},"unlisted":false,"nextItem":{"title":"SNCF Open Data: found items - 2","permalink":"/blog/2020/07/28/sncf-found-items-2"}},"content":"I opened my twitter account [@hugo\\\\_le\\\\_moine\\\\_](https://twitter.com/hugo_le_moine_) back in 2012 during my high school years, and have mostly used it to retweet/like content, using it like a bookmarking tool. Over time, I accumulated a couple hundreds tweets and I certainly don\'t remember >95% of them. \\n\\nIt\'s now time for a deep cleaning!\\n\\nBut... Twitter does not let you delete more than a tweet at time. Then how to automate this ?\\n\\n---\\n\\n# Twitter API\\n\\nLeveraging [Twitter API](https://developer.twitter.com/en/docs/api-reference-index) is the first option I explored. Twitter has built quite a comprehensive set of endpoints enabling developer to:\\n\\n- Post and delete a tweet / retweet / like / quote / bookmark\\n\\n- Search tweets \\n\\n- Follow / unfollow\\n\\n##### Applying for a developer account\\n\\nUsing Twitter API requires a [developer account](https://developer.twitter.com/en). The \\"Essential\\" level was enough for this tiny project. As I plan to try other functionalities later on, I got the \\"Elevated\\" level.\\n\\n##### Creating an app and getting your keys and tokens\\n\\nBefore we can dive into the API and play with the endpoints, we need some more configuration: [creating an app](https://developer.twitter.com/en/portal/apps/new). \\n\\n> Note: keys generated cannot be displayed again, in case you forgot to write them somewhere, you can still regenerate them.\\n\\nIn the \\"Settings\\" tab, the \\"OAuth 1.0a\\" must be activated, with \\"Read and write\\" permissions. The callback URI / Redirect URL can be your own github page.\\n\\nIn the Keys and tokens tab, you can now get your consumer keys and generate authentication tokens for your personal account.\\n\\n---\\n\\n# Tweepy\\n\\nAPIs can be used in most programming languages, and as Python is the one I am most comfortable with, I looked for a library that wraps the Twitter API for conveniency. I came across [tweepy](https://github.com/tweepy/tweepy).\\n\\n###### Credentials\\n\\nYour credentials can be stored in a yaml file to avoid hard-coding them in your python files (**do not commit your keys!**). For example in `delete-my-tweets.yaml`:\\n\\n```yaml\\ndelete-my-tweets-dev:\\n  consumer_key: ***********\\n  consumer_secret: **************\\n  access_token: *************************\\n  access_token_secret: **********************\\n  bearer_token: ********************************************\\n```\\n\\nThen, you can load them using [pyyaml](https://github.com/yaml/pyyaml):\\n\\n```python\\nimport yaml\\n\\n# https://stackoverflow.com/a/1774043/13765085\\nwith open(\\"delete-my-tweets.yaml\\", \\"r\\") as stream:\\n    try:\\n        parameters = yaml.safe_load(stream)[\'delete-my-tweets-dev\']\\n    except yaml.YAMLError as exc:\\n        print(exc)\\n```\\n\\n##### Initialize client\\n\\n```python\\nimport tweepy\\n\\nclient = tweepy.Client(\\n    bearer_token=parameters[\'bearer_token\'],\\n    consumer_key=parameters[\'consumer_key\'],\\n    consumer_secret=parameters[\'consumer_secret\'],\\n    access_token=parameters[\'access_token\'],\\n    access_token_secret=parameters[\'access_token_secret\'],\\n    wait_on_rate_limit=True, # to automatically wait when rate is exceeded\\n)\\n```\\n\\n##### Retrieve user\'s tweets\\n\\nTo get the list of tweets from a user, it is required to provide the id associated with the account. To get this information, you can use the method `get_user` and provide your username.\\n\\n```python\\nuser = client.get_user(username=\'hugo_le_moine_\')\\n```\\n\\nWe can now retrieve the account\'s tweets. The method `get_user_tweets` allows to collect tweets 100 at a time using pagination: each call will return a maximum of `max_results` tweets, and provide a token `next_token` allowing to collect the next tweets by passing it as an argument to the next call.\\n\\n> This method only allows to retrieve the most recent 3200 tweets.\\n\\nWe can write a recursive function that will go dig until the no more `next_token` is provided, and return all the tweets as a list.\\n\\n```python\\ndef collect_tweet_ids(next_token=None):\\n    # timeline contains tweets and metadata about the user\\n    timeline = client.get_users_tweets(\\n        id=user.data.id,\\n        max_results=100,\\n        pagination_token=next_token\\n    )\\n\\n    # get list of tweets\\n    tweet_list= timeline.data\\n\\n    # if a next page exists, append its results to the list of tweets\\n    if \'next_token\' in timeline.meta:\\n        tweet_list += collect_tweet_ids(timeline.meta[\'next_token\'])\\n    return tweet_list\\n```\\n\\nWe can now collect the tweets history:\\n\\n```python\\ntweets = collect_tweet_ids()\\n```\\n\\n##### Delete tweets\\n\\nFinally, we can use the tweet ids to delete them using the `delete_tweet` method. \\n\\n> **Warning**: twitter cap rate limits tweet deletion to 50 per 15 min window. Deleting all tweets can take a while, more than 8 hours in my case.\\n\\nI use [tqdm](https://github.com/tqdm/tqdm) to display a progress bar.\\n\\n```python\\nfrom tqdm import tqdm\\n\\nfor tweet in tqdm(tweets):\\n    client.delete_tweet(tweet.id)\\n```\\n\\n---\\n\\nThat\'s it!! I can now resume using twitter with a seemingly blank account, except that I get to keep all my settings and followings. I learnt to use the Twitter API and it\'s python wrapper tweepy, not in depth, but I will quite likely get back to it in the future!\\n\\nHas it been useful to you? Any faster way that you found? Any feedback will be appreciated, hit me up on twitter [@hugo_le_moine_](https://twitter.com/hugo_le_moine_)!"},{"id":"/2020/07/28/sncf-found-items-2","metadata":{"permalink":"/blog/2020/07/28/sncf-found-items-2","editUrl":"https://github.com/hugolmn/hugolmn.github.io/tree/main/blog/2020-07-28-sncf-found-items-2.md","source":"@site/blog/2020-07-28-sncf-found-items-2.md","title":"SNCF Open Data: found items - 2","description":"Data visualization using plotly","date":"2020-07-28T00:00:00.000Z","formattedDate":"July 28, 2020","tags":[{"label":"Data Visualization","permalink":"/blog/tags/data-visualization"},{"label":"Python","permalink":"/blog/tags/python"},{"label":"plotly","permalink":"/blog/tags/plotly"}],"readingTime":7.525,"hasTruncateMarker":false,"authors":[{"name":"Hugo Le Moine","title":"Data Scientist","url":"https://github.com/hugolmn","imageURL":"https://github.com/hugolmn.png","key":"hugo"}],"frontMatter":{"title":"SNCF Open Data: found items - 2","tags":["Data Visualization","Python","plotly"],"authors":"hugo","style":"border","color":"primary","description":"Data visualization using plotly"},"unlisted":false,"prevItem":{"title":"Twitter API - Delete my tweets!","permalink":"/blog/2022/06/11/delete-my-tweets"},"nextItem":{"title":"Covid19 and Google Trends","permalink":"/blog/2020/07/08/usa-covid-google-trends"}},"content":"## Map of found items\\n\\nFollowing a previous [article](https://hugolmn.github.io/2020/06/27/sncf-found-items.html) analyzing monthly evolution as well as concentration of found items, here is another perspective on these data made available by the SNCF. Obviously, the higher the number of passengers, the higher the number of found items. Now, let\'s look into the details!\\n\\nOn this map are represented the number of found items per 100k passengers between 2015 and 2018. Only stations with more than 10 found items are shown.\\n\\n<div class=\\"plotly-container\\">\\n    <iframe width=\\"100%\\" height=\\"700\\" frameborder=\\"0\\" scrolling=\\"no\\" src=\\"/graphs/sncf-found-items-map.html\\"></iframe>\\n</div>\\n\\n#### What can we conclude from this visualization ? \\n\\nClearly, there is a significant difference between the area of Paris/north of France, and anywhere else in the country. Nonetheless, one should avoid easy conclusion: are people more careful about their belongings or less prone to hand found items back ? The two options are possibly and even likely connected, but additional data are required to investigate. Perhaps in another part :)\\n\\n## Data\\n\\n- [SNCF : train station attendance](https://ressources.data.sncf.com/explore/dataset/frequentation-gares)\\n- [SNCF: train station list](https://ressources.data.sncf.com/explore/dataset/referentiel-gares-voyageurs)\\n- [SNCF: found items](https://ressources.data.sncf.com/explore/dataset/objets-trouves-restitution)\\n\\n## Libraries\\n\\nThe following libraries are imported:\\n\\n- [pandas](https://pandas.pydata.org/) and [numpy](https://numpy.org/) for data processing\\n- [plotly](https://plotly.com/python/).colors to use a specific colorscale\\n- [plotly](https://plotly.com/python/).graph_object for data visualization\\n\\n```python\\nimport pandas as pd\\t\\t\\t\\t\\t\\t\\nimport numpy as np\\t\\t\\t\\t\\t\\t\\nimport plotly.colors\\nimport plotly.graph_objects as go\\n```\\n\\n## Processing\\n\\n#### 1. Reading csv files\\n\\n```python\\ndf_frequentation = pd.read_csv(\'data/frequentation-gares.csv\', sep=\';\')\\ndf_gares = pd.read_csv(\'data/referentiel-gares-voyageurs.csv\', sep=\';\')\\ndf_items = pd.read_csv(\'data/objets-trouves-restitution.csv\', sep=\';\')\\n```\\n\\nThese two dataframes contain contain the following data:\\n\\n- `df_frequentation`: train station attendance data\\n\\n- `df_gares`: train station data, including latitude and longitude.\\n- `df_items`: found item data, including date and location.\\n\\nSample data from `df_frequentation`\\n\\n|      | Nom de la gare       | Code UIC complet | Code postal | Segmentation DRG 2018 | Total Voyageurs 2018 | Total Voyageurs + Non voyageurs 2018 | Total Voyageurs 2017 | Total Voyageurs + Non voyageurs 2017 | Total Voyageurs 2016 | Total Voyageurs + Non voyageurs 2016 | Total Voyageurs 2015 | Total Voyageurs + Non voyageurs 2015 |\\n| ---- | -------------------- | ---------------- | ----------- | --------------------- | -------------------- | ------------------------------------ | -------------------- | ------------------------------------ | -------------------- | ------------------------------------ | -------------------- | ------------------------------------ |\\n| 0    | Abancourt            | 87313759         | 60220       | c                     | 40228                | 40228                                | 43760                | 43760                                | 41096                | 41096.551614                         | 39720                | 39720                                |\\n| 1    | Agay                 | 87757559         | 83530       | c                     | 15093                | 15093                                | 14154                | 14154                                | 19240                | 19240.514370                         | 19121                | 19121                                |\\n| 2    | Agde                 | 87781278         | 34300       | a                     | 588297               | 735372                               | 697091               | 871364                               | 660656               | 825820.929253                        | 662516               | 828146                               |\\n| 3    | Agonac               | 87595157         | 24460       | c                     | 1492                 | 1492                                 | 1583                 | 1583                                 | 1134                 | 1134.699996                          | 1127                 | 1127                                 |\\n| 4    | Aigrefeuille Le Thou | 87485193         | 17290       | c                     | 18670                | 18670                                | 14513                | 14513                                | 266                  | 266.157144                           | 0                    | 0                                    |\\n\\nSample data from `df_gares`\\n\\n|      | Code plate-forme | Intitul\xe9 gare             | Intitul\xe9 fronton de gare  | Gare DRG | Gare \xe9trang\xe8re | Agence gare      | R\xe9gion SNCF                 | Unit\xe9 gare              | UT                           | Nbre plateformes | ...  | Longitude WGS84 | Latitude WGS84 | Code UIC | TVS  | Segment DRG | Niveau de service | SOP  | RG                           | Date fin validit\xe9 plateforme | WGS 84               |\\n| ---- | ---------------- | ------------------------- | ------------------------- | -------- | -------------- | ---------------- | --------------------------- | ----------------------- | ---------------------------- | ---------------- | ---- | --------------- | -------------- | -------- | ---- | ----------- | ----------------- | ---- | ---------------------------- | ---------------------------- | -------------------- |\\n| 0    | 00007-1          | Bourg-Madame              | Bourg-Madame              | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | BOURG MADAME GARE            | 1                | ...  | 1.948670        | 42.432407      | 87784876 | BMD  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.4324069,1.9486704 |\\n| 1    | 00014-1          | Bolqu\xe8re - Eyne           | Bolqu\xe8re - Eyne           | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | BOLQUERE EYNE GARE           | 1                | ...  | 2.087559        | 42.497873      | 87784801 | BQE  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.4978734,2.0875591 |\\n| 2    | 00015-1          | Mont-Louis - La Cabanasse | Mont-Louis - La Cabanasse | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | MONT LOUIS LA CABANASSE GARE | 1                | ...  | 2.113138        | 42.502090      | 87784793 | MTC  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.5020902,2.1131379 |\\n\\nSampel data from `df_items`\\n\\n|      | Date                      | Date et heure de restitution | Gare                       | Code UIC   | Nature d\'objets                              | Type d\'objets                      | Type d\'enregistrement |\\n| ---- | ------------------------- | ---------------------------- | -------------------------- | ---------- | -------------------------------------------- | ---------------------------------- | --------------------- |\\n| 0    | 2014-03-09T14:25:29+01:00 | NaN                          | Paris Montparnasse         | 87391003.0 | Manteau, veste, blazer, parka, blouson, cape | V\xeatements, chaussures              | Objet trouv\xe9          |\\n| 1    | 2018-01-23T15:07:32+01:00 | NaN                          | Saint-\xc9tienne Ch\xe2teaucreux | 87726000.0 | Montre                                       | Bijoux, montres                    | Objet trouv\xe9          |\\n| 2    | 2018-02-06T15:35:49+01:00 | NaN                          | Rennes                     | 87471003.0 | Cl\xe9s, porte-cl\xe9s                             | Cl\xe9s, porte-cl\xe9s, badge magn\xe9tique | Objet trouv\xe9          |\\n\\n#### 2. Merging dataframes\\n\\nThe three dataframes have a column identifier: the UIC code (\\"Union Internationale des Chemins de fer\\", International Union of Railways in french). We can merge them based on this unique value for each station.\\n\\n```python\\ndf = df_gares.merge(\\n    right=df_frequentation, \\n    left_on=\'Code UIC\', \\n    right_on=\'Code UIC complet\', \\n    how=\'inner\')\\n\\ndf = df.merge(df_items, on=\'Code UIC\', how=\'right\')\\n```\\n\\n#### 3. Conversion to datetime\\n\\nFor now, the DataFrame has a Date column, but was not assigned any particular format.\\n\\n```python\\ndf.Date.dtype\\n```\\n\\n> ```\\n> >> dtype(\'O\')\\n> ```\\n\\nIn order to have a standardized datetime, `pandas.to_datetime` can be applied to get a datetime, and then `tz_convert` to make it french time.\\n\\n```python\\ndf[\'Date\'] = pd.to_datetime(df.Date, utc=True).dt.tz_convert(\'Europe/Paris\')\\n```\\n\\n#### 4. Filtering dates\\n\\nAs I want to analyze the number of found items according to the number of passengers, I must filter out data which is not in the period 2015-2018 as these are the only years for which the number of passengers is available.\\n\\n```python\\ndf = df.loc[(df.Date.dt.year >= 2015) & (df.Date.dt.year <= 2018)]\\n```\\n\\n#### 5. Total number of passengers per station\\n\\n```python\\ndf[\'Passengers\'] =(df[\'Total Voyageurs 2018\'] \\n                            + df[\'Total Voyageurs 2017\'] \\n                            + df[\'Total Voyageurs 2016\'] \\n                            + df[\'Total Voyageurs 2015\'])\\n```\\n\\n#### 6. Grouping data by train station\\n\\nData is grouped by station name, geographical coordinates are kept, as well as the count of found items, and the number of passengers.\\n\\n```python\\ndf = (df.groupby(by=\\"Intitul\xe9 gare\\")\\n        .agg({\'Longitude WGS84\': \'first\',\\n              \'Latitude WGS84\': \'first\',\\n              \'Nature d\\\\\'objets\': len,\\n              \'Passengers\': \'first\'})\\n        .rename(columns={\'Nature d\\\\\'objets\': \'item_count\'})\\n)\\n```\\n\\n#### 7. Count per 100k\\n\\nIn this blog post, the focus is put on the ratio item/pax. A straightforward division would lead to number hard to imagine. Therefore, using a ratio per 100k passengers is more interesting. I restricted the selection to stations having at least 10 found items .\\n\\n```python\\ndf[\'count_per_100kpax\'] = df.item_count / df.Passengers * 1e5\\ndf = df.sort_values(by=\'count_per_100kpax\', ascending=False)\\ndf = df[df.item_count >= 10]\\n```\\n\\n#### 8. Creation of categories\\n\\nTo group data by category on the map, we need to bin them. I chose a standard quantile binning with 20% of data in each bin.\\n\\n```python\\ndf[\'group\'] = pd.qcut(df[\'count_per_100kpax\'], q=np.linspace(0, 1, 6))\\n```\\n\\n#### 9. What we have so far\\n\\n| Intitul\xe9 gare          | Longitude WGS84 | Latitude WGS84 | item_count | Passengers | count_per_100kpax | category         |\\n| ---------------------- | --------------- | -------------- | ---------- | ---------- | ----------------- | ---------------- |\\n| Versailles Rive Droite | 2.134752        | 48.809653      | 39         | 21309519.0 | 0.183017          | (0.182, 3.623]   |\\n| Poissy                 | 2.041368        | 48.932901      | 80         | 43120958.0 | 0.185525          | (0.182, 3.623]   |\\n| ...                    | ...             | ...            | ...        | ...        | ...               | ...              |\\n| Hendaye                | -1.781724       | 43.353132      | 2873       | 1422622.0  | 201.951045        | (24.664, 323.36] |\\n| Le Croisic             | -2.507442       | 47.289836      | 1358       | 419966.0   | 323.359510        | (24.664, 323.36] |\\n\\n## Visualization\\n\\nNow that all the processing part is completed, we can proceed to the  visualization.\\n\\n```python\\nfig = go.Figure()\\ncolors = plotly.colors.sequential.Inferno # Custom colormap\\n\\n# One scattermapbox per group\\nfor i, group in enumerate(df.group.cat.categories):\\n    df_sub = df[df.group == group]\\n    fig.add_trace(go.Scattermapbox(\\n            lat=df_sub[\'Latitude WGS84\'], \\n            lon=df_sub[\'Longitude WGS84\'],\\n            text=df_sub.index,\\n            marker=dict(\\n                color=colors[2*i],\\n                size=df_sub[\'count_per_100kpax\'],\\n                sizemin=3,\\n                sizeref=.35,\\n                sizemode=\'area\',\\n                opacity=.8,\\n            ),\\n            meta=df_sub[\'item_count\'],\\n            hovertemplate=\\"%{text}\\" + \\"<br>\\" \\n                            + \\"Found items: %{meta}\\" + \\"<br>\\" \\n                            + \\"Per 100kPax: \\" + \\"%{marker.size:.1f}\\",\\n            name=f\'> {cat.left:.0f} per 100kPax\',          \\n    ))\\n```\\n\\n```python\\n# Defining map style, margins, and original position\\nfig.update_layout(\\n    mapbox_style=\\"open-street-map\\",\\n    #title=\'Passengers per french train station in 2018\',\\n    margin={\'l\': 0, \'r\': 0, \'t\': 0, \'b\': 0},\\n    mapbox=dict(\\n        center={\'lon\': 2.39, \'lat\': 47.09},\\n        zoom=4\\n    ),\\n)\\n# Legend layout\\nfig.update_layout(legend={\'orientation\': \'h\', \'y\': 0})\\n```\\n\\nLink to the [Jupyter notebook](https://github.com/hugolmn/dataviz/blob/master/SNCF_found_item_2.ipynb)."},{"id":"/2020/07/08/usa-covid-google-trends","metadata":{"permalink":"/blog/2020/07/08/usa-covid-google-trends","editUrl":"https://github.com/hugolmn/hugolmn.github.io/tree/main/blog/2020-07-08-usa-covid-google-trends.md","source":"@site/blog/2020-07-08-usa-covid-google-trends.md","title":"Covid19 and Google Trends","description":"Trend anaysis between covid19 cases and Google searches","date":"2020-07-08T00:00:00.000Z","formattedDate":"July 8, 2020","tags":[{"label":"Data Visualization","permalink":"/blog/tags/data-visualization"},{"label":"Python","permalink":"/blog/tags/python"},{"label":"plotly","permalink":"/blog/tags/plotly"}],"readingTime":0.745,"hasTruncateMarker":false,"authors":[{"name":"Hugo Le Moine","title":"Data Scientist","url":"https://github.com/hugolmn","imageURL":"https://github.com/hugolmn.png","key":"hugo"}],"frontMatter":{"title":"Covid19 and Google Trends","tags":["Data Visualization","Python","plotly"],"authors":"hugo","style":"border","color":"primary","description":"Trend anaysis between covid19 cases and Google searches"},"unlisted":false,"prevItem":{"title":"SNCF Open Data: found items - 2","permalink":"/blog/2020/07/28/sncf-found-items-2"},"nextItem":{"title":"SNCF Open Data: found items - 1","permalink":"/blog/2020/06/27/sncf-found-items"}},"content":"## USA Covid19 Cases vs. Google Trends\\n\\nBased on user searches, [Google Flu](https://www.google.org/flutrends/about/) tried to estimate flu prevalence among populations. In this simple visualization I try to use a similar, yet simplified approach. Below are compared USA reported covid19 cases against Google Trends popularity for \\"Coronavirus\\" and \\"Worldometer\\" (which is a website used worldwide to track this pandemic).\\n\\n<iframe width=\\"100%\\" height=\\"400\\" frameborder=\\"0\\" scrolling=\\"no\\" src=\\"//plotly.com/~hugolmn/55.embed?link=false&autosize=true&modebar=false\\"></iframe>\\n\\n## Timeline\\n\\n- January 2020: quick spread in China\\n- Mid-February : spread to Europe\\n- \\"Coronavirus\\" popularity peaks on 15th March, when USA cases growth rate is maximal.\\n- \\"Worldometer\\" popularity peaks two weeks later.\\n- 11th April: USA 7-day moving average peaks.\\n- 31th May: USA 7-day moving average bottoms to a 2-month low.\\n- Since June: cases are up to new daily records, but popularity of \\"Coronavirus\\" remains low.\\n\\n## Data\\n\\n- [CDC USA](https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/cases-in-us.html)\\n- [Google Trends](https://trends.google.com/trends/explore?date=2020-01-01%202020-12-31&geo=US&q=%2Fm%2F01cpyy)\\n\\n\\nLink to the [Jupyter notebook](https://github.com/hugolmn/dataviz/blob/master/USA-Google-Trends.ipynb)."},{"id":"/2020/06/27/sncf-found-items","metadata":{"permalink":"/blog/2020/06/27/sncf-found-items","editUrl":"https://github.com/hugolmn/hugolmn.github.io/tree/main/blog/2020-06-27-sncf-found-items.md","source":"@site/blog/2020-06-27-sncf-found-items.md","title":"SNCF Open Data: found items - 1","description":"Data visualization using plotly","date":"2020-06-27T00:00:00.000Z","formattedDate":"June 27, 2020","tags":[{"label":"Data Visualization","permalink":"/blog/tags/data-visualization"},{"label":"Python","permalink":"/blog/tags/python"},{"label":"plotly","permalink":"/blog/tags/plotly"}],"readingTime":6.385,"hasTruncateMarker":false,"authors":[{"name":"Hugo Le Moine","title":"Data Scientist","url":"https://github.com/hugolmn","imageURL":"https://github.com/hugolmn.png","key":"hugo"}],"frontMatter":{"title":"SNCF Open Data: found items - 1","tags":["Data Visualization","Python","plotly"],"authors":"hugo","style":"border","color":"primary","description":"Data visualization using plotly"},"unlisted":false,"prevItem":{"title":"Covid19 and Google Trends","permalink":"/blog/2020/07/08/usa-covid-google-trends"},"nextItem":{"title":"SNCF Open Data: train station attendance","permalink":"/blog/2020/06/17/sncf-train-station-attendance"}},"content":"## Monthly found items in french train stations\\n\\nWe can view found items as a proxy for passenger traffic. On this first chart, we can clearly identify a few traffic disruptions:\\n\\n- April 2018 to June 2018 : discontinuous strike against project to reform SNCF.\\n- December 2019 : strike against pension reform.\\n- March 2020 to June 2020 : Covid-19 restrictions.\\n\\nWe can also observe a peak in July each year, corresponding to summer vacations for most people.\\n\\n<iframe height=\\"400\\" width=\\"100%\\" frameborder=\\"0\\" scrolling=\\"no\\" src=\\"//plotly.com/~hugolmn/21.embed?link=false&autosize=true\\"></iframe>\\n\\n## 18% of stations represent 80% of found items\\n\\n<iframe height=\\"600\\" width=\\"100%\\" frameborder=\\"0\\" scrolling=\\"no\\" src=\\"//plotly.com/~hugolmn/14.embed?link=false&autosize=true\\"></iframe>\\n\\n## Data\\n\\n- [SNCF: train station list](https://ressources.data.sncf.com/explore/dataset/referentiel-gares-voyageurs)\\n- [SNCF: found items](https://ressources.data.sncf.com/explore/dataset/objets-trouves-restitution)\\n\\n## Libraries\\n\\nThe following libraries are imported:\\n\\n- [pandas](https://pandas.pydata.org/) and [numpy](https://numpy.org/) for data processing\\n- [plotly](https://plotly.com/python/).colors to use a specific colorscale\\n- [plotly](https://plotly.com/python/).graph_object for data visualization\\n\\n```python\\nimport pandas as pd\\t\\t\\t\\t\\t\\t\\nimport numpy as np\\t\\t\\t\\t\\t\\t\\nimport plotly.colors\\nimport plotly.graph_objects as go\\n```\\n\\n## Processing\\n\\n#### 1. Reading csv files\\n\\n```python\\ndf_gares = pd.read_csv(\'data/referentiel-gares-voyageurs.csv\', sep=\';\')\\ndf_items = pd.read_csv(\'data/objets-trouves-restitution.csv\', sep=\';\')\\n```\\n\\nThese two dataframes contain contain the following data:\\n\\n- `df_gares`: train station data, including latitude and longitude.\\n- `df_items`: found item data, including date and location.\\n\\nSample data from `df_gares`\\n\\n|      | Code plate-forme | Intitul\xe9 gare             | Intitul\xe9 fronton de gare  | Gare DRG | Gare \xe9trang\xe8re | Agence gare      | R\xe9gion SNCF                 | Unit\xe9 gare              | UT                           | Nbre plateformes | ...  | Longitude WGS84 | Latitude WGS84 | Code UIC | TVS  | Segment DRG | Niveau de service | SOP  | RG                           | Date fin validit\xe9 plateforme | WGS 84               |\\n| ---- | ---------------- | ------------------------- | ------------------------- | -------- | -------------- | ---------------- | --------------------------- | ----------------------- | ---------------------------- | ---------------- | ---- | --------------- | -------------- | -------- | ---- | ----------- | ----------------- | ---- | ---------------------------- | ---------------------------- | -------------------- |\\n| 0    | 00007-1          | Bourg-Madame              | Bourg-Madame              | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | BOURG MADAME GARE            | 1                | ...  | 1.948670        | 42.432407      | 87784876 | BMD  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.4324069,1.9486704 |\\n| 1    | 00014-1          | Bolqu\xe8re - Eyne           | Bolqu\xe8re - Eyne           | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | BOLQUERE EYNE GARE           | 1                | ...  | 2.087559        | 42.497873      | 87784801 | BQE  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.4978734,2.0875591 |\\n| 2    | 00015-1          | Mont-Louis - La Cabanasse | Mont-Louis - La Cabanasse | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | MONT LOUIS LA CABANASSE GARE | 1                | ...  | 2.113138        | 42.502090      | 87784793 | MTC  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.5020902,2.1131379 |\\n\\nSampel data from `df_items`\\n\\n|      | Date                      | Date et heure de restitution | Gare                       | Code UIC   | Nature d\'objets                              | Type d\'objets                      | Type d\'enregistrement |\\n| ---- | ------------------------- | ---------------------------- | -------------------------- | ---------- | -------------------------------------------- | ---------------------------------- | --------------------- |\\n| 0    | 2014-03-09T14:25:29+01:00 | NaN                          | Paris Montparnasse         | 87391003.0 | Manteau, veste, blazer, parka, blouson, cape | V\xeatements, chaussures              | Objet trouv\xe9          |\\n| 1    | 2018-01-23T15:07:32+01:00 | NaN                          | Saint-\xc9tienne Ch\xe2teaucreux | 87726000.0 | Montre                                       | Bijoux, montres                    | Objet trouv\xe9          |\\n| 2    | 2018-02-06T15:35:49+01:00 | NaN                          | Rennes                     | 87471003.0 | Cl\xe9s, porte-cl\xe9s                             | Cl\xe9s, porte-cl\xe9s, badge magn\xe9tique | Objet trouv\xe9          |\\n\\n#### 2. Conversion to datetime\\n\\nFor now, the DataFrame has a Date column, but was not assigned any particular format.\\n\\n```python\\ndf.Date.dtype\\n```\\n\\n> ```\\n> >> dtype(\'O\')\\n> ```\\n\\nIn order to have a standardized datetime, `pandas.to_datetime`can be applied to get a datetime, and then `tz_convert`to make it french time.\\n\\n```python\\ndf[\'Date\'] = pd.to_datetime(df.Date, utc=True).dt.tz_convert(\'Europe/Paris\')\\n```\\n\\n#### 3. Filtering dates\\n\\nTo know when data collection has actually been put into place, let\'s analyse dates contained in the DataFrame.\\n\\n```python\\ndf.Date.dt.year.value_counts().sort_index()\\n```\\n\\n| Date | Count  |\\n| ---- | ------ |\\n| 2013 | 15698  |\\n| 2014 | 102793 |\\n| 2015 | 111706 |\\n| 2016 | 107595 |\\n| 2017 | 107662 |\\n| 2018 | 116308 |\\n| 2019 | 122637 |\\n| 2020 | 26143  |\\n\\nTo keep consistency, I decided to drop data from 2013: data collection may have not started everywhere, and had definitely not started in January 2013. If we want to dig deeper into the data and check correlations with passenger count, it would be difficult to achieve if data are not complete. Therefore only data collected from 2014 onwards will be kept:\\n\\n```python\\ndf = df[df.Date.dt.year >= 2014]\\n```\\n\\n#### 5. Grouping data by year and month\\n\\nIn the first chart, I wanted to plot found item count for each month in the dataset. To do so, we need to group by year, then month.\\n\\n```python\\ndf_months = df.groupby(by=[df.Date.dt.year, df.Date.dt.month]).Date.count()\\n```\\n\\nThe result is the following:\\n\\n```python\\n2014  1       5788\\n      2       5815\\n      3       7012\\n      4       8543\\n      5       8657\\n              ... \\n2020  2       9271\\n      3       4473\\n      4         72\\n      5       1386\\n      6       3649\\n```\\n\\nNow we need to get the index back to datetime, combining years and months.\\n\\n```python\\ndf_months.index = df_months.index.map(lambda t: pd.to_datetime(\'-\'.join(map(str, t))))\\n```\\n\\n\\n\\n#### 6. Grouping data by train station\\n\\nThe second chart was made after grouping by train station. It can be achieved by the following instructions:\\n\\n```python\\ndf_grouped = (df\\n    .groupby(by=\'Gare\')\\n    .count()\\n    .Date\\n    .rename(\'Count\')\\n    .sort_values(ascending=False)\\n)\\n```\\n\\nThis will first group by train station name, then apply a count aggregation, keep the Date renamed as Count, and values will be sorted from greatest to lowest count.\\n\\n#### 7. Pareto\\n\\nThe `df_grouped`DataFrame allows us to demonstrate an application of the Pareto priciple. The following lines are doing:\\n\\n- Cumulative found item count of `df_grouped`\\n- Sum of all items in `df_grouped`\\n- Assigning booleans to cumulative counts below 80% of the total number of items, and counting them\\n\\n```python\\npareto = (df_grouped.cumsum() < df_grouped.sum() * 0.8).sum()\\n```\\n\\nThe `df_grouped`DataFrame contains 181 train stations, and 32  (18%) of them account for 80% of the total count of found items.\\n\\n#### 8. Filtering grouped data\\n\\nUsing the Pareto principle described above, I filtered `df_grouped`to keep the first 32 rows for visualization purpose.\\n\\n```python\\ndf_grouped = df_grouped.iloc[:pareto]\\n```\\n\\n## Visualization\\n\\nNow that all the processing part is completed, we can proceed to visualization.\\n\\n### 1. Monthly found items\\n\\nThe first chart is simply a bar chart of the total count of found items per month. `x` will therefore be the index of the dataframe `df_months`, and `y`  will be the sum of all found items found for the associated months. \\n\\n```python\\nfig = go.Figure()\\nfig.add_trace(\\n    go.Bar(\\n        x=df_months.index,\\n        y=df_months, \\n        hoverinfo=\\"x+y\\",\\n        marker_color=\\"#007bff\\",  \\n))\\n```\\n\\nThen, y axis title is added, as well as margins to enhance the result.\\n\\n```python\\nfig.update_layout(\\n    yaxis=dict(title=\\"Found items in train stations\\", titlefont=dict(size=16)),\\n    margin={\'l\': 30, \'r\': 30, \'t\': 50, \'b\': 0},\\n)\\n```\\n\\n### 2. Found items per train station\\n\\nThe second chart is also a bar chart. The data plotted are the counts of found items in each train station. As mentioned in the processing part, only the first 32 stations are displayed, ordered by number of found items.\\n\\n```python\\nfig.add_trace(\\n    go.Bar(\\n        x=np.arange(1, len(df_grouped)), \\n        y=df_grouped, \\n        text=df_grouped.index,\\n        meta = df_grouped,\\n        hoverinfo=\\"text+y\\",\\n        name=\\"Found items\\",\\n        marker_color=\\"#007bff\\"\\n))\\n```\\n\\nThe final step is adjusting the layout: margins, axis titles and log scale for the y axis.\\n\\n```python\\n\\nfig.update_layout(\\n    margin={\'l\':20, \'r\': 0, \'t\': 0, \'b\': 250},\\n    xaxis=dict(tickangle=-90,\\n               tickfont={\'size\': 14}),\\n    yaxis=dict(title=\\"Found items per station\\",\\n               type=\\"log\\",\\n               titlefont=dict(size=16))\\n)\\n```\\n\\nLink to the [Jupyter notebook](https://github.com/hugolmn/dataviz/blob/master/SNCF_found_item_1.ipynb)."},{"id":"/2020/06/17/sncf-train-station-attendance","metadata":{"permalink":"/blog/2020/06/17/sncf-train-station-attendance","editUrl":"https://github.com/hugolmn/hugolmn.github.io/tree/main/blog/2020-06-17-sncf-train-station-attendance.md","source":"@site/blog/2020-06-17-sncf-train-station-attendance.md","title":"SNCF Open Data: train station attendance","description":"Geo-visualization of train stations","date":"2020-06-17T00:00:00.000Z","formattedDate":"June 17, 2020","tags":[{"label":"Data Visualization","permalink":"/blog/tags/data-visualization"},{"label":"Python","permalink":"/blog/tags/python"},{"label":"plotly","permalink":"/blog/tags/plotly"}],"readingTime":4.995,"hasTruncateMarker":false,"authors":[{"name":"Hugo Le Moine","title":"Data Scientist","url":"https://github.com/hugolmn","imageURL":"https://github.com/hugolmn.png","key":"hugo"}],"frontMatter":{"title":"SNCF Open Data: train station attendance","tags":["Data Visualization","Python","plotly"],"authors":"hugo","style":"border","color":"primary","description":"Geo-visualization of train stations"},"unlisted":false,"prevItem":{"title":"SNCF Open Data: found items - 1","permalink":"/blog/2020/06/27/sncf-found-items"}},"content":"## Passengers per french train station in 2018\\n\\n<div class=\\"plotly-container\\">\\n    <iframe width=\\"100%\\" height=\\"700\\" frameborder=\\"0\\" scrolling=\\"no\\" src=\\"/graphs/sncf-train-stations.html\\"></iframe>\\n</div>\\n\\n## Data\\n\\n- [SNCF : train station attendance](https://ressources.data.sncf.com/explore/dataset/frequentation-gares)\\n- [SNCF : train station list](https://ressources.data.sncf.com/explore/dataset/referentiel-gares-voyageurs)\\n\\n## Libraries\\n\\nThe following libraries are imported:\\n\\n- [pandas](https://pandas.pydata.org/) and [numpy](https://numpy.org/) for data processing\\n- [plotly](https://plotly.com/python/).colors to use a specific color scale\\n- [plotly](https://plotly.com/python/).graph_object for data visualization\\n\\n```python\\nimport pandas as pd\\t\\t\\t\\t\\t\\t\\nimport numpy as np\\t\\t\\t\\t\\t\\t\\nimport plotly.colors\\nimport plotly.graph_objects as go\\n```\\n\\n## Processing\\n\\n#### 1. Reading csv files\\n\\n```python\\ndf_frequentation = pd.read_csv(\'data/frequentation-gares.csv\', sep=\';\')\\ndf_gares = pd.read_csv(\'data/referentiel-gares-voyageurs.csv\', sep=\';\')\\n```\\n\\nSample data from df_frequentation\\n\\n|      | Nom de la gare       | Code UIC complet | Code postal | Segmentation DRG 2018 | Total Voyageurs 2018 | Total Voyageurs + Non voyageurs 2018 | Total Voyageurs 2017 | Total Voyageurs + Non voyageurs 2017 | Total Voyageurs 2016 | Total Voyageurs + Non voyageurs 2016 | Total Voyageurs 2015 | Total Voyageurs + Non voyageurs 2015 |\\n| ---- | -------------------- | ---------------- | ----------- | --------------------- | -------------------- | ------------------------------------ | -------------------- | ------------------------------------ | -------------------- | ------------------------------------ | -------------------- | ------------------------------------ |\\n| 0    | Abancourt            | 87313759         | 60220       | c                     | 40228                | 40228                                | 43760                | 43760                                | 41096                | 41096.551614                         | 39720                | 39720                                |\\n| 1    | Agay                 | 87757559         | 83530       | c                     | 15093                | 15093                                | 14154                | 14154                                | 19240                | 19240.514370                         | 19121                | 19121                                |\\n| 2    | Agde                 | 87781278         | 34300       | a                     | 588297               | 735372                               | 697091               | 871364                               | 660656               | 825820.929253                        | 662516               | 828146                               |\\n| 3    | Agonac               | 87595157         | 24460       | c                     | 1492                 | 1492                                 | 1583                 | 1583                                 | 1134                 | 1134.699996                          | 1127                 | 1127                                 |\\n| 4    | Aigrefeuille Le Thou | 87485193         | 17290       | c                     | 18670                | 18670                                | 14513                | 14513                                | 266                  | 266.157144                           | 0                    | 0                                    |\\n\\nSample data from df_gares\\n\\n|      | Code plate-forme | Intitul\xe9 gare             | Intitul\xe9 fronton de gare  | Gare DRG | Gare \xe9trang\xe8re | Agence gare      | R\xe9gion SNCF                 | Unit\xe9 gare              | UT                           | Nbre plateformes | ...  | Longitude WGS84 | Latitude WGS84 | Code UIC | TVS  | Segment DRG | Niveau de service | SOP  | RG                           | Date fin validit\xe9 plateforme | WGS 84               |\\n| ---- | ---------------- | ------------------------- | ------------------------- | -------- | -------------- | ---------------- | --------------------------- | ----------------------- | ---------------------------- | ---------------- | ---- | --------------- | -------------- | -------- | ---- | ----------- | ----------------- | ---- | ---------------------------- | ---------------------------- | -------------------- |\\n| 0    | 00007-1          | Bourg-Madame              | Bourg-Madame              | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | BOURG MADAME GARE            | 1                | ...  | 1.948670        | 42.432407      | 87784876 | BMD  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.4324069,1.9486704 |\\n| 1    | 00014-1          | Bolqu\xe8re - Eyne           | Bolqu\xe8re - Eyne           | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | BOLQUERE EYNE GARE           | 1                | ...  | 2.087559        | 42.497873      | 87784801 | BQE  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.4978734,2.0875591 |\\n| 2    | 00015-1          | Mont-Louis - La Cabanasse | Mont-Louis - La Cabanasse | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | MONT LOUIS LA CABANASSE GARE | 1                | ...  | 2.113138        | 42.502090      | 87784793 | MTC  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.5020902,2.1131379 |\\n| 3    | 00020-1          | Thu\xe8s les Bains           | Thu\xe8s les Bains           | True     | False          | Agence Grand Sud | REGION LANGUEDOC-ROUSSILLON | UG Languedoc Roussillon | THUES LES BAINS GARE         | 1                | ...  | 2.249094        | 42.528801      | 87784744 | THB  | c           | 1.0               | NaN  | GARES C LANGUEDOC ROUSSILLON | NaN                          | 42.5288009,2.249094  |\\n\\n#### 2. Merging dataframes\\n\\nThe UIC Code is a unique ID for train stations. However, the column names are different in both files, so it\'s mandatory so specify the **`left_on`** and **`right_on`** arguments. \\n\\n```python\\ndf = df_gares.merge(\\n    right=df_frequentation,\\n    left_on=\'Code UIC\',\\n    right_on=\'Code UIC complet\',\\n    how=\'inner\')\\n```\\n\\n#### 3. Filtering\\n\\nIn order to avoid keeping small train stations, I chose to filter out stations with attendance below 1000 passengers in 2018. For visualization purpose, I added a column holding the square root of the number of passengers per station\\n\\n```python\\ndf = df[df[\'Total Voyageurs 2018\'] > 1000]\\n```\\n\\n#### 4. Adding a category column\\n\\nBy using `pandas.cut` data can be split into categories according to total number of passengers. This will allow to plot with a different color for each category.\\n\\n```python\\ndf[\'category\'] = pd.cut(df[\'Total Voyageurs 2018\'], bins=[1e4, 1e5, 1e6, 1e7, np.inf])\\n```\\n\\n## Visualization\\n\\n[Plotly](https://plotly.com/) is a handy tool when it comes to creating interactive graphs and plots, that you can embed in other websites.\\n\\n#### 1. Scatter Mapbox\\n\\nData contain latitude and longitude: these will be used to plot train stations on the map. The size of the bubbles will depend on the square root of the number of passengers in 2018. A different trace is added for each of the categories defined above. Finally, information shown on mouse-hovering is defined using `hovertemplate`.\\n\\n```python\\nfig = go.Figure()\\ncolors = plotly.colors.sequential.Viridis\\n\\nfor i, cat in enumerate(df.category.cat.categories):\\n    df_sub = df[df.category == cat]\\n    fig.add_trace(go.Scattermapbox(\\n        lat=df_sub[\'Latitude WGS84\'], \\n        lon=df_sub[\'Longitude WGS84\'],\\n        text=df_sub[\'Intitul\xe9 gare\'],\\n        marker=dict(\\n            color=colors[2*i+1],\\n            size=np.sqrt(df_sub[\'Total Voyageurs 2018 sqrt\']),\\n            sizemin=1,\\n            sizeref=15,\\n            sizemode=\'area\',\\n            opacity=.8,\\n        ),\\n        meta=df_sub[\'Total Voyageurs 2018\'],\\n        hovertemplate=\\"%{text}\\" + \\"<br>\\" + \\"Passengers: %{meta}\\",\\n        name=f\'> {cat.left:1.0e} passengers\',          \\n))\\n```\\n\\n#### 2. Layout\\n\\nThe last step is adding the background map, the title, margins around the plot, and the initial position & zoom.\\n\\n```python\\nfig.update_layout(\\n    mapbox_style=\\"open-street-map\\",\\n    title=\'Passengers per french train station in 2018\',\\n    margin={\'l\': 0, \'r\': 0, \'t\': 50, \'b\': 0},\\n    mapbox=dict(\\n        center={\'lon\': 2.39, \'lat\': 47.09},\\n        zoom=4\\n    ),\\n)\\n```\\n\\nLink to the [Jupyter notebook](https://github.com/hugolmn/dataviz/blob/master/SNCF_traffic.ipynb)."}]}')}}]);