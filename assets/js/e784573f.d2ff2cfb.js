"use strict";(self.webpackChunkdocusaurus_test=self.webpackChunkdocusaurus_test||[]).push([[618],{4137:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,h=c["".concat(s,".").concat(d)]||c[d]||m[d]||o;return n?a.createElement(h,l(l({ref:t},u),{},{components:n})):a.createElement(h,l({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[c]="string"==typeof e?e:r,l[1]=i;for(var p=2;p<o;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9893:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>m,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=n(7462),r=(n(7294),n(4137));const o={title:"Twitter API - Delete my tweets!",tags:["Python","API","Twitter"],authors:"hugo",style:"border",color:"primary",description:"I reset my account using twitter API, to delete all my existing tweets."},l="Why?",i={permalink:"/blog/2022/06/11/delete-my-tweets",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2022-06-11-delete-my-tweets.md",source:"@site/blog/2022-06-11-delete-my-tweets.md",title:"Twitter API - Delete my tweets!",description:"I reset my account using twitter API, to delete all my existing tweets.",date:"2022-06-11T00:00:00.000Z",formattedDate:"June 11, 2022",tags:[{label:"Python",permalink:"/blog/tags/python"},{label:"API",permalink:"/blog/tags/api"},{label:"Twitter",permalink:"/blog/tags/twitter"}],readingTime:3.565,hasTruncateMarker:!1,authors:[{name:"Hugo Le Moine",title:"Data Scientist",url:"https://github.com/hugolmn",imageURL:"https://github.com/hugolmn.png",key:"hugo"}],frontMatter:{title:"Twitter API - Delete my tweets!",tags:["Python","API","Twitter"],authors:"hugo",style:"border",color:"primary",description:"I reset my account using twitter API, to delete all my existing tweets."},nextItem:{title:"SNCF Open Data: found items - 2",permalink:"/blog/2020/07/28/sncf-found-items-2"}},s={authorsImageUrls:[void 0]},p=[{value:"Applying for a developer account",id:"applying-for-a-developer-account",level:5},{value:"Creating an app and getting your keys and tokens",id:"creating-an-app-and-getting-your-keys-and-tokens",level:5},{value:"Credentials",id:"credentials",level:6},{value:"Initialize client",id:"initialize-client",level:5},{value:"Retrieve user&#39;s tweets",id:"retrieve-users-tweets",level:5},{value:"Delete tweets",id:"delete-tweets",level:5}],u={toc:p},c="wrapper";function m(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"I opened my twitter account ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/hugo_le_moine_"},"@hugo","_","le","_","moine","_")," back in 2012 during my high school years, and have mostly used it to retweet/like content, using it like a bookmarking tool. Over time, I accumulated a couple hundreds tweets and I certainly don't remember >95% of them. "),(0,r.kt)("p",null,"It's now time for a deep cleaning!"),(0,r.kt)("p",null,"But... Twitter does not let you delete more than a tweet at time. Then how to automate this ?"),(0,r.kt)("hr",null),(0,r.kt)("h1",{id:"twitter-api"},"Twitter API"),(0,r.kt)("p",null,"Leveraging ",(0,r.kt)("a",{parentName:"p",href:"https://developer.twitter.com/en/docs/api-reference-index"},"Twitter API")," is the first option I explored. Twitter has built quite a comprehensive set of endpoints enabling developer to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Post and delete a tweet / retweet / like / quote / bookmark")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Search tweets ")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Follow / unfollow"))),(0,r.kt)("h5",{id:"applying-for-a-developer-account"},"Applying for a developer account"),(0,r.kt)("p",null,"Using Twitter API requires a ",(0,r.kt)("a",{parentName:"p",href:"https://developer.twitter.com/en"},"developer account"),'. The "Essential" level was enough for this tiny project. As I plan to try other functionalities later on, I got the "Elevated" level.'),(0,r.kt)("h5",{id:"creating-an-app-and-getting-your-keys-and-tokens"},"Creating an app and getting your keys and tokens"),(0,r.kt)("p",null,"Before we can dive into the API and play with the endpoints, we need some more configuration: ",(0,r.kt)("a",{parentName:"p",href:"https://developer.twitter.com/en/portal/apps/new"},"creating an app"),". "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note: keys generated cannot be displayed again, in case you forgot to write them somewhere, you can still regenerate them.")),(0,r.kt)("p",null,'In the "Settings" tab, the "OAuth 1.0a" must be activated, with "Read and write" permissions. The callback URI / Redirect URL can be your own github page.'),(0,r.kt)("p",null,"In the Keys and tokens tab, you can now get your consumer keys and generate authentication tokens for your personal account."),(0,r.kt)("hr",null),(0,r.kt)("h1",{id:"tweepy"},"Tweepy"),(0,r.kt)("p",null,"APIs can be used in most programming languages, and as Python is the one I am most comfortable with, I looked for a library that wraps the Twitter API for conveniency. I came across ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/tweepy/tweepy"},"tweepy"),"."),(0,r.kt)("h6",{id:"credentials"},"Credentials"),(0,r.kt)("p",null,"Your credentials can be stored in a yaml file to avoid hard-coding them in your python files (",(0,r.kt)("strong",{parentName:"p"},"do not commit your keys!"),"). For example in ",(0,r.kt)("inlineCode",{parentName:"p"},"delete-my-tweets.yaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"delete-my-tweets-dev:\n  consumer_key: ***********\n  consumer_secret: **************\n  access_token: *************************\n  access_token_secret: **********************\n  bearer_token: ********************************************\n")),(0,r.kt)("p",null,"Then, you can load them using ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/yaml/pyyaml"},"pyyaml"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},'import yaml\n\n# https://stackoverflow.com/a/1774043/13765085\nwith open("delete-my-tweets.yaml", "r") as stream:\n    try:\n        parameters = yaml.safe_load(stream)[\'delete-my-tweets-dev\']\n    except yaml.YAMLError as exc:\n        print(exc)\n')),(0,r.kt)("h5",{id:"initialize-client"},"Initialize client"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"import tweepy\n\nclient = tweepy.Client(\n    bearer_token=parameters['bearer_token'],\n    consumer_key=parameters['consumer_key'],\n    consumer_secret=parameters['consumer_secret'],\n    access_token=parameters['access_token'],\n    access_token_secret=parameters['access_token_secret'],\n    wait_on_rate_limit=True, # to automatically wait when rate is exceeded\n)\n")),(0,r.kt)("h5",{id:"retrieve-users-tweets"},"Retrieve user's tweets"),(0,r.kt)("p",null,"To get the list of tweets from a user, it is required to provide the id associated with the account. To get this information, you can use the method ",(0,r.kt)("inlineCode",{parentName:"p"},"get_user")," and provide your username."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"user = client.get_user(username='hugo_le_moine_')\n")),(0,r.kt)("p",null,"We can now retrieve the account's tweets. The method ",(0,r.kt)("inlineCode",{parentName:"p"},"get_user_tweets")," allows to collect tweets 100 at a time using pagination: each call will return a maximum of ",(0,r.kt)("inlineCode",{parentName:"p"},"max_results")," tweets, and provide a token ",(0,r.kt)("inlineCode",{parentName:"p"},"next_token")," allowing to collect the next tweets by passing it as an argument to the next call."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This method only allows to retrieve the most recent 3200 tweets.")),(0,r.kt)("p",null,"We can write a recursive function that will go dig until the no more ",(0,r.kt)("inlineCode",{parentName:"p"},"next_token")," is provided, and return all the tweets as a list."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"def collect_tweet_ids(next_token=None):\n    # timeline contains tweets and metadata about the user\n    timeline = client.get_users_tweets(\n        id=user.data.id,\n        max_results=100,\n        pagination_token=next_token\n    )\n\n    # get list of tweets\n    tweet_list= timeline.data\n\n    # if a next page exists, append its results to the list of tweets\n    if 'next_token' in timeline.meta:\n        tweet_list += collect_tweet_ids(timeline.meta['next_token'])\n    return tweet_list\n")),(0,r.kt)("p",null,"We can now collect the tweets history:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"tweets = collect_tweet_ids()\n")),(0,r.kt)("h5",{id:"delete-tweets"},"Delete tweets"),(0,r.kt)("p",null,"Finally, we can use the tweet ids to delete them using the ",(0,r.kt)("inlineCode",{parentName:"p"},"delete_tweet")," method. "),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("strong",{parentName:"p"},"Warning"),": twitter cap rate limits tweet deletion to 50 per 15 min window. Deleting all tweets can take a while, more than 8 hours in my case.")),(0,r.kt)("p",null,"I use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/tqdm/tqdm"},"tqdm")," to display a progress bar."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"from tqdm import tqdm\n\nfor tweet in tqdm(tweets):\n    client.delete_tweet(tweet.id)\n")),(0,r.kt)("hr",null),(0,r.kt)("p",null,"That's it!! I can now resume using twitter with a seemingly blank account, except that I get to keep all my settings and followings. I learnt to use the Twitter API and it's python wrapper tweepy, not in depth, but I will quite likely get back to it in the future!"),(0,r.kt)("p",null,"Has it been useful to you? Any faster way that you found? Any feedback will be appreciated, hit me up on twitter ",(0,r.kt)("a",{parentName:"p",href:"https://twitter.com/hugo_le_moine_"},"@hugo",(0,r.kt)("em",{parentName:"a"},"le_moine")),"!"))}m.isMDXComponent=!0}}]);